<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Voter JSON or Form</title>
<style>
body { font-family: Arial; padding:20px; background:#f7f7f7; }
h2 { text-align:center; margin-bottom:20px; }

textarea, input { width:100%; padding:10px; font-size:16px; border:2px solid #aaa; border-radius:6px; margin-bottom:10px; }
button { padding:10px 15px; font-size:16px; border-radius:6px; border:1px solid #777; cursor:pointer; margin-top:5px; }

#status { margin-top:10px; font-weight:bold; padding:8px; border-radius:6px; }
.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
.warning { background:#fff3cd; color:#856404; border:1px solid #ffeeba; }

.section { background:white; padding:15px; border-radius:10px; margin-bottom:20px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
.section h3 { margin-top:0; }
</style>
</head>
<body>

<h2>üó≥ Add Voter to Firebase</h2>

<div class="section">
  <h3>1Ô∏è‚É£ Add via JSON (Bulk)</h3>
  <p>Enter JSON array of voter objects:</p>
  <textarea id="jsonInput">[
  {
    "serial_no": 360,
    "epic_no": "RBG5489920",
    "sl_no_in_part": "131/272/360",
    "voter_full_name": "New Voter",
    "relation_name": "Relation Name",
    "relation_type": "Father's Name",
    "house_number": "NA",
    "age": 30,
    "gender": "Male"
  }
]</textarea>
  <button onclick="addJSON()">Add JSON</button>
</div>

<div class="section">
  <h3>2Ô∏è‚É£ Add Single Voter via Form</h3>
  <input type="number" id="fSerial" placeholder="Serial No">
  <input type="text" id="fEpic" placeholder="EPIC No">
  <input type="text" id="fSlNo" placeholder="Sl No in Part">
  <input type="text" id="fName" placeholder="Voter Full Name">
  <input type="text" id="fRelation" placeholder="Relation Name">
  <input type="text" id="fRelationType" placeholder="Relation Type (Father/Mother/Husband)">
  <input type="text" id="fHouse" placeholder="House Number">
  <input type="number" id="fAge" placeholder="Age">
  <input type="text" id="fGender" placeholder="Gender">
  <button onclick="addSingleVoter()">Add Single Voter</button>
</div>

<div id="status"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const requiredFields = ["serial_no","epic_no","sl_no_in_part","voter_full_name","relation_name","relation_type","house_number","age","gender"];

function showStatus(msg, type){
  const status = document.getElementById("status");
  status.innerText = msg;
  status.className = type;
}

// --------------- Bulk JSON Add ----------------
function addJSON() {
  const input = document.getElementById("jsonInput").value.trim();
  let newVoters;

  try {
    newVoters = JSON.parse(input);
    if (!Array.isArray(newVoters)) {
      showStatus("‚ùå Please enter a valid array of voter objects!", "error");
      return;
    }
  } catch(e) {
    showStatus("‚ùå Invalid JSON format!", "error");
    return;
  }

  // Validate each voter
  for(let i=0;i<newVoters.length;i++){
    let v = newVoters[i];
    for(let f of requiredFields){
      if(!(f in v)){
        showStatus(`‚ùå Missing field '${f}' in voter at index ${i}`, "error");
        return;
      }
    }
  }

  // Fetch existing voters
  db.ref("voters").once("value").then(snap=>{
    const existing = snap.val() || {};
    let added=0, skipped=0;

    newVoters.forEach(v=>{
      const key = v.epic_no;
      if(existing[key]) skipped++;
      else { existing[key]=v; added++; }
    });

    db.ref("voters").set(existing)
      .then(()=>{
        if(added>0 && skipped===0) showStatus(`‚úÖ ${added} voter(s) added successfully!`, "success");
        else if(added>0 && skipped>0) showStatus(`‚úÖ ${added} added, ‚ö†Ô∏è ${skipped} skipped (EPIC exists)`, "warning");
        else if(added===0 && skipped>0) showStatus(`‚ö†Ô∏è All ${skipped} voters skipped (EPIC exists)`, "warning");
      })
      .catch(err=>showStatus("‚ùå Error: "+err.message,"error"));
  });
}

// --------------- Single Voter Form Add ----------------
function addSingleVoter(){
  let voter = {
    serial_no: parseInt(document.getElementById("fSerial").value),
    epic_no: document.getElementById("fEpic").value.trim(),
    sl_no_in_part: document.getElementById("fSlNo").value.trim(),
    voter_full_name: document.getElementById("fName").value.trim(),
    relation_name: document.getElementById("fRelation").value.trim(),
    relation_type: document.getElementById("fRelationType").value.trim(),
    house_number: document.getElementById("fHouse").value.trim(),
    age: parseInt(document.getElementById("fAge").value),
    gender: document.getElementById("fGender").value.trim()
  };

  // Validate
  for(let f of requiredFields){
    if(!voter[f] && voter[f]!==0){
      showStatus(`‚ùå Field '${f}' is required!`, "error");
      return;
    }
  }

  db.ref("voters").once("value").then(snap=>{
    const existing = snap.val() || {};
    if(existing[voter.epic_no]){
      showStatus(`‚ö†Ô∏è EPIC ${voter.epic_no} already exists! Skipped.`, "warning");
      return;
    }
    existing[voter.epic_no]=voter;
    db.ref("voters").set(existing)
      .then(()=> showStatus(`‚úÖ Voter ${voter.voter_full_name} added successfully!`, "success"))
      .catch(err=> showStatus("‚ùå Error: "+err.message,"error"));
  });
}
</script>
</body>
</html>
