<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Voter Preview Only</title>
<style>
body { font-family: Arial; margin:0; padding:10px; background:#f3f3f3; }
h2 { text-align:center; margin-bottom:15px; }
input, textarea, select {
    width:100%; padding:10px; margin-bottom:12px;
    border-radius:8px; border:2px solid #777; font-size:16px;
}
.list-item{
    padding:14px;background:white;border:2px solid #aaa;
    margin-bottom:10px;border-radius:12px;cursor:pointer;
    transition:.3s;font-size:16px;
}
.highlight { background: #ffe08a !important; border-color:#d6a300 !important; }
.list-item:hover{ transform:scale(1.03); box-shadow:0 0 10px gray; }
#popup{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.7);display:none;
    justify-content:center;align-items:flex-start;
    padding:20px;overflow-y:auto;
}
.card{
    width:95%;max-width:420px;background:white;
    border:3px solid black;border-radius:15px;padding:20px;
}
.card img{
    width:100%;max-height:200px;object-fit:contain;
    border-radius:12px;margin-bottom:10px;
}
.btn{
    padding:12px;width:100%;margin-top:10px;background:#008cff;
    color:white;border:none;font-size:16px;cursor:pointer;
    border-radius:10px;box-shadow:0 4px 0 #003f7f;
}
.btn:active{ transform:translateY(4px); }
.close-btn{ background:red;box-shadow:0 4px 0 #7a0000; }
.color-btn{ background:#ffa600; box-shadow:0 4px 0 #b36b00; }

/* PRINT */
@media print{
    body *{ visibility:hidden; }
    #popup, #popup *{ visibility:visible; }
    .btn{ display:none !important; }
}
.lang-switch { text-align:center; margin-bottom:12px; }
.lang-switch select { padding:8px 12px; font-size:16px; border-radius:8px; border:2px solid #007bff; }
</style>
</head>
<body>

<!-- LANGUAGE SWITCH -->
<div class="lang-switch">
  <select id="lang">
    <option value="mr">ЁЯЗоЁЯЗ│ рдорд░рд╛рдареА (Marathi)</option>
    <option value="en">ЁЯЗоЁЯЗ│ English</option>
  </select>
</div>

<!-- Translate Area -->
<div id="translateArea">
    <h2 class="label" data-mr="ЁЯЧ│ рдорддрджрд╛рд░ рдпрд╛рджреА рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди" data-en="ЁЯЧ│ Voter List Preview">ЁЯЧ│ рдорддрджрд╛рд░ рдпрд╛рджреА рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди</h2>
    <label class="label" data-mr="рдорддрджрд╛рддрд╛ рд╢реЛрдзрд╛" data-en="Search Voter:">рдорддрджрд╛рддрд╛ рд╢реЛрдзрд╛</label>
</div>

<!-- Search and List -->
<input id="search" class="label" 
       data-mr="рдирд╛рд╡, EPIC, AC рдХреНрд░., рднрд╛рдЧ рдХреНрд░., рдкрддреНрддрд╛ рд╢реЛрдзрд╛" 
       data-en="Search Name, EPIC, AC No, Part No, Address, Booth, Message..."
       placeholder="рдирд╛рд╡, EPIC, AC рдХреНрд░., рднрд╛рдЧ рдХреНрд░., рдкрддреНрддрд╛ рд╢реЛрдзрд╛">
<div id="list"></div>

<!-- Popup -->
<div id="popup">
    <div class="card" id="cardBox">
        <h3 id="pName"></h3>
        <p><b class="label" data-mr="ЁЯЖФ EPIC рдХреНрд░рдорд╛рдВрдХ:" data-en="ЁЯЖФ EPIC:">ЁЯЖФ EPIC рдХреНрд░рдорд╛рдВрдХ:</b> <span id="pEpic"></span></p>
        <p><b class="label" data-mr="ЁЯПЫ рд╡рд┐рдзрд╛рдирд╕рднрд╛:" data-en="ЁЯПЫ AC No:">ЁЯПЫ рд╡рд┐рдзрд╛рдирд╕рднрд╛:</b> <span id="pAc"></span></p>
        <p><b class="label" data-mr="ЁЯУН рднрд╛рдЧ рдХреНрд░рдорд╛рдВрдХ:" data-en="ЁЯУН Part No:">ЁЯУН рднрд╛рдЧ рдХреНрд░рдорд╛рдВрдХ:</b> <span id="pPart"></span></p>
        <p><b class="label" data-mr="ЁЯПа рдкрддреНрддрд╛:" data-en="ЁЯПа Address:">ЁЯПа рдкрддреНрддрд╛:</b> <span id="pAddress"></span></p>
        <p><b class="label" data-mr="ЁЯЧ│ рдорддрджрд╛рди рдХреЗрдВрджреНрд░:" data-en="ЁЯЧ│ Booth:">ЁЯЧ│ рдорддрджрд╛рди рдХреЗрдВрджреНрд░:</b> <span id="pVoteAddress"></span></p>

        <img id="voterImage" style="display:none; margin-top:10px;">

        <label class="label" data-mr="ЁЯУЭ рд╕рдВрджреЗрд╢:" data-en="ЁЯУЭ Sender Message:"><b>ЁЯУЭ рд╕рдВрджреЗрд╢:</b></label>
        <input id="senderNote" placeholder="рд╕рдВрджреЗрд╢ рдЯрд╛рдХрд╛ / Type message here">

        <button class="btn color-btn" onclick="highlightItem()">ЁЯОи рд╣рд╛рдпрд▓рд╛рдЗрдЯ / Highlight</button>
        <button class="btn" onclick="printDetails()">ЁЯЦи рдЫрд╛рдкрд╛ / Print</button>
        <button class="btn" onclick="sendWhatsApp()">ЁЯУй WhatsApp</button>
        <button class="btn close-btn" onclick="closePopup()">тЭМ рдмрдВрдж рдХрд░рд╛ / Close</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>
<script>
// Firebase config (unchanged)
firebase.initializeApp({
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com/",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com"
});

let voters={}, selected=null, globalSenderNote="", activeListItem=null;

// Load voters
firebase.database().ref("/").once("value").then(snap=>{
    globalSenderNote = snap.val().GlobalSenderNote || "";
    voters = snap.val().Voters || {};
    showList(voters);
});

// Show list
function showList(data){
    const box = document.getElementById("list");
    box.innerHTML = "";
    Object.values(data).forEach(v=>{
        const div = document.createElement("div");
        div.className = "list-item";
        // Name line kept as-is (data is language-neutral). You can localize icons/text if needed.
        div.innerHTML = `<b>${v.Name}</b><br>ЁЯЖФ ${v.EPIC} | ЁЯПЫ AC:${v.AcNo} | ЁЯУН Part:${v.PartNo}`;
        div.onclick = ()=>{ activeListItem=div; openPopup(v); };
        box.appendChild(div);
    });
}

// Open popup
function openPopup(v){
    selected=v;
    document.getElementById("pName").innerText=v.Name;
    document.getElementById("pEpic").innerText=v.EPIC;
    document.getElementById("pAc").innerText=v.AcNo;
    document.getElementById("pPart").innerText=v.PartNo;
    document.getElementById("pAddress").innerText=v.Address||"";
    document.getElementById("pVoteAddress").innerText=v.VotingAddress||"";
    document.getElementById("senderNote").value=v.SenderNote||globalSenderNote;

    const img=document.getElementById("voterImage");
    if(v.ImageURL){ img.src=v.ImageURL; img.style.display="block"; }
    else img.style.display="none";

    document.getElementById("popup").style.display="flex";
}

// Highlight
function highlightItem(){
    if(activeListItem) activeListItem.classList.toggle("highlight");
    document.getElementById("cardBox").classList.toggle("highlight");
}

// Close popup
function closePopup(){ document.getElementById("popup").style.display="none"; }

// Print
function printDetails(){ window.print(); }

// WhatsApp
function sendWhatsApp(){
    if(!selected) return;
    const msg=`ЁЯСд Name: ${selected.Name}
ЁЯЖФ EPIC: ${selected.EPIC}
ЁЯПа Address: ${selected.Address || ""}
ЁЯУН Booth: ${selected.VotingAddress || ""}
ЁЯУЭ Message: ${document.getElementById("senderNote").value || ""}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
}

// Search
document.getElementById("search").addEventListener("input", e=>{
    const t=e.target.value.toLowerCase();
    const f=Object.values(voters).filter(v=>
        (v.Name||"").toLowerCase().includes(t) ||
        (v.EPIC||"").toLowerCase().includes(t) ||
        (v.AcNo+"").includes(t) ||
        (v.PartNo+"").includes(t) ||
        (v.Address||"").toLowerCase().includes(t) ||
        (v.VotingAddress||"").toLowerCase().includes(t) ||
        (v.SenderNote||"").toLowerCase().includes(t)
    );
    showList(f);
});

/* ---------------------------
   Manual language switching
   (Rasta-3: data attributes)
   ---------------------------*/
function applyLanguage(lang) {
  // labels: elements with class "label"
  document.querySelectorAll(".label").forEach(el => {
    // prefer data-mr / data-en values, preserve emoji if present
    const attr = (lang === "mr") ? el.dataset.mr : el.dataset.en;
    if (attr !== undefined) {
      // If element contains emoji at start in dataset, it's already included.
      // For inputs (placeholder) vs normal text nodes:
      if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
        el.placeholder = attr;
      } else {
        // For label elements that include <b> child (like sender label), handle innerHTML carefully
        // Keep existing emoji if dataset doesn't include emoji: dataset should include emoji+text.
        el.innerText = attr;
      }
    }
  });

  // Also handle placeholders for elements that are not .label but translatable, e.g., the search input was class label already.
  // If you have other elements with data attributes, they can be included by adding the "label" class.
}

// attach listener
document.getElementById("lang").addEventListener("change", function () {
  applyLanguage(this.value);
});

// default language = Marathi
applyLanguage("mr");
</script>
</body>
</html>
