<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter List</title>

<style>
.voter-button {
    /* ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§¨‡§ü‡§® ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡§ø‡§Ç‡§ó */
    display: inline-block;
    padding: 15px 30px; /* ‡§™‡•à‡§°‡§ø‡§Ç‡§ó ‡§∏‡•á ‡§¨‡§ü‡§® ‡§¨‡•ú‡§æ ‡§¶‡§ø‡§ñ‡§§‡§æ ‡§π‡•à */
    border: none;
    border-radius: 12px; /* ‡§ó‡•ã‡§≤ ‡§ï‡§ø‡§®‡§æ‡§∞‡•á */
    font-size: 18px;
    font-weight: bold;
    text-decoration: none; /* ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§ï‡•Ä ‡§≤‡§æ‡§á‡§® ‡§π‡§ü‡§æ‡§®‡§æ */
    cursor: pointer;
    transition: all 0.2s ease; /* ‡§π‡•ã‡§µ‡§∞ ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è */
    
    /* ‡§∞‡§Ç‡§ó‡•Ä‡§® ‡§î‡§∞ 3D ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü */
    background-color: #4CAF50; /* ‡§π‡§∞‡§æ ‡§∞‡§Ç‡§ó */
    color: white;
    
    /* 3D ‡§â‡§≠‡§∞‡§æ ‡§π‡•Å‡§Ü ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü */
    /* ‡§®‡•Ä‡§ö‡•á ‡§î‡§∞ ‡§¶‡§æ‡§è‡§Ç ‡§ï‡•Ä ‡§§‡§∞‡§´ ‡§ó‡§π‡§∞‡•á ‡§∞‡§Ç‡§ó ‡§ï‡§æ ‡§∂‡•à‡§°‡•ã 3D ‡§≤‡•Å‡§ï ‡§¶‡•á‡§§‡§æ ‡§π‡•à */
    box-shadow: 0 9px #38761D; 
}

/* ‡§Æ‡§æ‡§â‡§∏ ‡§ì‡§µ‡§∞ (Hover) ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü */
.voter-button:hover {
    background-color: #45A049; /* ‡§π‡•ã‡§µ‡§∞ ‡§™‡§∞ ‡§π‡§≤‡•ç‡§ï‡§æ ‡§∞‡§Ç‡§ó */
    box-shadow: 0 7px #38761D; /* ‡§∂‡•à‡§°‡•ã ‡§ï‡•ã ‡§•‡•ã‡§°‡§º‡§æ ‡§â‡§†‡§æ‡§®‡§æ */
    transform: translateY(-2px); /* ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§ä‡§™‡§∞ ‡§â‡§†‡§æ‡§®‡§æ */
}

/* ‡§ï‡•ç‡§≤‡§ø‡§ï (Active) ‡§á‡§´‡§º‡•á‡§ï‡•ç‡§ü - ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§Ö‡§Ç‡§¶‡§∞ ‡§¶‡§¨‡§æ‡§®‡§æ */
.voter-button:active {
    background-color: #3e8e41;
    box-shadow: 0 4px #38761D; /* ‡§∂‡•à‡§°‡•ã ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡§®‡§æ */
    transform: translateY(5px); /* ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§®‡•Ä‡§ö‡•á ‡§¶‡§¨‡§æ‡§®‡§æ */
}



  
body { font-family: Arial; margin:0; padding:10px; background:#f1f1f1; }

/* üî• scrolling text */
#scrollText {
  width:100%;
  background:#ffeb3b;
  padding:8px;
  font-size:18px;
  font-weight:bold;
  overflow:hidden;
  white-space:nowrap;
  box-sizing:border-box;
}
#scrollText span {
  display:inline-block;
  padding-left:100%;
  animation: scroll 12s linear infinite;
}
@keyframes scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* Notice box */
.notice-box {
  background:#fff3cd;
  padding:10px;
  border-left:6px solid #ff9800;
  border-radius:6px;
  margin:12px 0;
  font-size:17px;
}

/* UI */
h2 { text-align:center; margin-bottom:15px; }
#searchBox { width:100%; padding:10px; border:2px solid #999; border-radius:6px; font-size:18px; margin-bottom:15px; }
.result-item { padding:10px; margin:5px 0; background:white; border-radius:6px; border-left:5px solid #007bff; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }

#card { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:flex-start; padding:20px; overflow-y:auto; }

.card-content{ background:white; padding:15px; border-radius:10px; max-width:450px; width:95%; position:relative; }
.close-btn{ position:absolute; top:10px; right:10px; background:red; border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer; }

.color-btn { width:30px; height:30px; border-radius:6px; border:none; margin-right:8px; cursor:pointer; }

#msg { width:100%; height:80px; padding:8px; border:2px solid #aaa; border-radius:6px; }

.btn-small { padding:8px 15px; border:none; border-radius:6px; margin-right:10px; cursor:pointer; color:white; }
.btn-save { background:#28a745; }
.btn-del { background:#dc3545; }
.btn-print { background:#007bff; }
.btn-whatsapp { background:#25d366; }
.btn-download { background:#6a1b9a; }   /* NEW BUTTON */

.voter-color-tag { width:20px; height:20px; border-radius:4px; display:inline-block; }
</style>
</head>
<body>

<!-- üî• Scrolling Text -->
<div id="scrollText"><span>‡§ï‡•É‡§™‡§Ø‡§æ Search Box ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§™‡§≤‡§æ EPIC ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ‚Ä¶ -------------------‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§Ø‡§æ‡§¶‡•Ä‡§§ ‡§§‡•Å‡§Æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§Ü‡§π‡•á ‡§ï‡§æ ‡§§‡•á ‡§§‡§™‡§æ‡§∏‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§¨‡§ü‡§£‡§æ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ.</span></div>

<!-- üî• Notice Box -->
<div class="notice-box">
<b>‡§∏‡•Ç‡§ö‡§®‡§æ:</b> ‡§∂‡•ã‡§ß‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä Search Box ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§™‡§≤‡•á ‡§®‡§æ‡§µ ‡§ï‡§ø‡§Ç‡§µ‡§æ EPIC ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ.
</div>

<h2>Voter Search</h2>

<input type="text" id="searchBox" placeholder="Type 1 letter or EPIC to search..." />
<div id="results"></div>

<!-- CARD -->
<div id="card">
  <div class="card-content">
    <button class="close-btn" onclick="closeCard()">X</button>
    <h3 id="vname"></h3>
    <p><b>EPIC:</b> <span id="vepic"></span></p>
    <p><b>Serial/Part:</b> <span id="vserial"></span></p>
    <p><b>Area:</b> <span id="varea"></span></p>
    <p><b>House No:</b> <span id="vhouse"></span></p>
    <p><b>Ward:</b> <span id="vward"></span></p>
    <p><b>Relation:</b> <span id="vrelation"></span></p>
    <p><b>Age/Gender:</b> <span id="vage"></span> / <span id="vgender"></span></p>
    <p><b>Saved Color:</b> <span class="voter-color-tag" id="colortag"></span></p>

    <hr>
    <p><b>Change Color:</b></p>
    <button class="color-btn" style="background:#ff4444" onclick="saveColor('#ff4444')"></button>
    <button class="color-btn" style="background:#44cc44" onclick="saveColor('#44cc44')"></button>
    <button class="color-btn" style="background:#4477ff" onclick="saveColor('#4477ff')"></button>

    <hr>
    <p><b>Sender Message:</b></p>
    <textarea id="msg"></textarea>
    <button class="btn-small btn-save" onclick="saveMessage()">Save</button>
    <button class="btn-small btn-del" onclick="deleteMessage()">Delete</button>

    <hr>
    <button class="btn-small btn-print" onclick="printCard()">Print</button>
    <button class="btn-small btn-whatsapp" onclick="sendWhatsApp()">Send</button>
    <button class="btn-small btn-download" onclick="downloadPDF()">Download</button> <!-- NEW -->
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let voters = [];
let activeVoter = null;

// Load voters
db.ref("voters").once("value").then(snap => {
    const data = snap.val() || {};
    voters = Object.keys(data).map(key => ({
        key: key,
        epic_no: data[key].EPIC_NO || key,
        voter_full_name: data[key].VoterName || "NA",
        sl_no_in_part: data[key].PartNo || "NA",
        area: data[key].Area || "NA",
        house_no: data[key].HouseNo || "NA",
        ward: data[key].Ward || "NA",
        relation_name: data[key].RelationName || "NA",
        relation_type: data[key].RelationType || "NA",
        age: data[key].Age || "NA",
        gender: data[key].Gender || "NA",
        color: data[key].color || "#ffffff",
        message: data[key].message || ""
    }));
    renderResults();
});

// Search
function renderResults() {
  const q = document.getElementById("searchBox").value.toLowerCase();
  let html="";
  if(q.length>=1){
    voters.forEach(v=>{
      if(v.voter_full_name.toLowerCase().includes(q) || v.epic_no.toLowerCase().includes(q)){
        html+=`<div class="result-item" onclick="openCard('${v.key}')">
                 <span><b>${v.voter_full_name}</b> (${v.epic_no})</span>
                 <span class="voter-color-tag" style="background:${v.color}"></span>
               </div>`;
      }
    });
  }
  document.getElementById("results").innerHTML=html;
}
document.getElementById("searchBox").addEventListener("input", renderResults);

// CARD
function openCard(key){
  activeVoter = voters.find(v=>v.key===key);
  if(!activeVoter) return;

  document.getElementById("vname").innerText = activeVoter.voter_full_name;
  document.getElementById("vepic").innerText = activeVoter.epic_no;
  document.getElementById("vserial").innerText = activeVoter.sl_no_in_part;
  document.getElementById("varea").innerText = activeVoter.area;
  document.getElementById("vhouse").innerText = activeVoter.house_no;
  document.getElementById("vward").innerText = activeVoter.ward;
  document.getElementById("vrelation").innerText = `${activeVoter.relation_name} (${activeVoter.relation_type})`;
  document.getElementById("vage").innerText = activeVoter.age;
  document.getElementById("vgender").innerText = activeVoter.gender;
  document.getElementById("colortag").style.background = activeVoter.color;
  document.getElementById("msg").value = activeVoter.message;

  document.getElementById("card").style.display = "flex";
}

function closeCard(){ document.getElementById("card").style.display="none"; }

function saveColor(c){
  if(!activeVoter) return;
  activeVoter.color=c;
  db.ref("voters/"+activeVoter.key+"/color").set(c);
  document.getElementById("colortag").style.background=c;
  renderResults();
}

function saveMessage(){
  activeVoter.message=document.getElementById("msg").value;
  db.ref("voters/"+activeVoter.key+"/message").set(activeVoter.message);
  alert("Saved!");
}

function deleteMessage(){
  db.ref("voters/"+activeVoter.key+"/message").remove();
  document.getElementById("msg").value="";
}

// ‚úî NEW ‚Äî PDF Download
function downloadPDF(){
  if(!activeVoter) return;

  let content =
`Voter Details
--------------------
Name: ${activeVoter.voter_full_name}
EPIC: ${activeVoter.epic_no}
Serial/Part: ${activeVoter.sl_no_in_part}
Area: ${activeVoter.area}
House No: ${activeVoter.house_no}
Ward: ${activeVoter.ward}
Relation: ${activeVoter.relation_name} (${activeVoter.relation_type})
Age/Gender: ${activeVoter.age} / ${activeVoter.gender}

Message:
${activeVoter.message}
`;

  const blob = new Blob([content], {type: "text/plain"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = activeVoter.epic_no + "_voter_details.txt";
  a.click();
  URL.revokeObjectURL(url);
}

function printCard(){
  let text = document.querySelector(".card-content").innerText;
  let w = window.open("", "", "width=450,height=600");
  w.document.write("<pre>"+text+"</pre>");
  w.print();
}

function sendWhatsApp(){
  let text =
`*Voter Details*
Name: ${activeVoter.voter_full_name}
EPIC: ${activeVoter.epic_no}
Serial/Part: ${activeVoter.sl_no_in_part}
Area: ${activeVoter.area}
House No: ${activeVoter.house_no}
Ward: ${activeVoter.ward}
Relation: ${activeVoter.relation_name} (${activeVoter.relation_type})
Age/Gender: ${activeVoter.age} / ${activeVoter.gender}

Message:
${activeVoter.message}`;

  window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
}
</script>
<!-- üî• Notice Box -->
<div class="notice-box">
<b>‡§∏‡•Ç‡§ö‡§®‡§æ:</b> ‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§Ø‡§æ‡§¶‡•Ä‡§§ ‡§§‡•Å‡§Æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§Ü‡§π‡•á ‡§ï‡§æ ‡§§‡•á ‡§§‡§™‡§æ‡§∏‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§¨‡§ü‡§£‡§æ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ.
</div>


    
  <a href="https://mahasecvoterlist.in/ObjectionOnClick/SearchVoterName" target="_blank" class="voter-button">
    ‚úÖ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç
</a>
</body>
</html>
