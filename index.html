<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter App - Ward 20</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- PapaParse -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">

<style>
  .btn-3d {
    background: linear-gradient(145deg, #4f46e5, #6366f1);
    color: white;
    font-weight: bold;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    box-shadow: 4px 4px 6px #333, -4px -4px 6px #777;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-3d:hover {
    box-shadow: inset 4px 4px 6px #333, inset -4px -4px 6px #777;
  }
  #fullscreenImg {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
    z-index:9999;
  }
  #fullscreenImg img { max-width:90%; max-height:90%; border-radius:0.5rem; }
</style>
</head>
<body class="bg-gray-100">

<!-- Top Logo + Ward + Admin Image Upload -->
<div class="flex items-center justify-between bg-white p-2 shadow-md mb-4 sticky top-0 z-50">
  <div class="flex items-center">
    <img src="logo.png" alt="Logo" class="h-12 w-12 mr-2 rounded-full shadow-lg cursor-pointer" onclick="alert('Logo Clicked!')">
    <h1 class="text-xl font-bold">Ward 20</h1>
  </div>
  <div id="adminImageUploadDiv" class="hidden flex items-center">
    <input type="file" id="adminScreenImage" class="border p-1 mr-2 rounded">
    <button class="btn-3d" onclick="setAdminScreenImage()">Set Screen Image</button>
  </div>
</div>

<!-- Login -->
<div id="loginDiv" class="flex justify-center items-center h-screen">
  <button class="btn-3d" onclick="login()">Login with Google</button>
</div>

<!-- Main SPA -->
<div id="mainDiv" class="hidden p-4">

  <!-- Admin Panel -->
  <div id="adminPanel" class="hidden mb-4 border p-2 rounded bg-white shadow">
    <h1 class="text-xl font-bold">Admin Panel</h1>

    <h2 class="mt-2 font-semibold">Add User / Member</h2>
    <form id="addUserForm" class="flex flex-col">
      <input type="text" id="newUserName" placeholder="Name" class="border p-1 my-1" required>
      <input type="email" id="newUserEmail" placeholder="Email" class="border p-1 my-1" required>
      <select id="newUserRole" class="border p-1 my-1">
        <option value="user">User</option>
        <option value="member">Member</option>
      </select>
      <button type="submit" class="btn-3d my-1">Add</button>
    </form>

    <h2 class="mt-4 font-semibold">Import Voters from CSV</h2>
    <input type="text" id="sheetCSV" placeholder="CSV URL" class="border p-1 my-1 w-full">
    <button class="btn-3d my-1" onclick="importVotersFromSheet()">Import Voters</button>

    <h2 class="mt-4 font-semibold">Voter List (Admin)</h2>
    <div id="voterListAdmin" class="overflow-auto max-h-64 mt-2 border p-2"></div>

    <h2 class="mt-4 font-semibold">Member Surveys</h2>
    <div id="memberSurveys" class="overflow-auto max-h-64 mt-2 border p-2"></div>
  </div>

  <!-- User Panel -->
  <div id="userPanel" class="hidden mb-4 border p-2 rounded bg-white shadow">
    <h1 class="text-xl font-bold">Voter List</h1>
    <input type="text" id="searchInput" placeholder="Search by name..." class="border p-1 my-2 w-full">
    <div id="voterListUser" class="overflow-auto max-h-64 border p-2"></div>
  </div>

  <!-- Member Panel -->
  <div id="memberPanel" class="hidden mb-4 border p-2 rounded bg-white shadow">
    <h1 class="text-xl font-bold">Member Survey Form</h1>
    <form id="surveyForm" class="flex flex-col">
      <input type="text" id="memberName" placeholder="Your Name" required class="border p-1 my-1">
      <input type="text" id="memberMobile" placeholder="Mobile" required class="border p-1 my-1">
      <input type="text" id="memberWard" placeholder="Ward No" required class="border p-1 my-1">
      <input type="file" id="memberPoster" required class="border p-1 my-1">
      <button type="submit" class="btn-3d my-2">Submit Survey</button>
    </form>

    <h2 class="mt-4 font-semibold">Member Survey Counts</h2>
    <div id="memberCount" class="overflow-auto max-h-64 mt-2 border p-2"></div>
  </div>

</div>

<!-- Fullscreen Image -->
<div id="fullscreenImg" onclick="this.style.display='none'">
  <img id="fullImg" src="">
</div>

<script src="firebase-config.js"></script>
<script src="app.js"></script>
</body>
</html>
