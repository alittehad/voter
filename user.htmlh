<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Voter Directory</title>

<style>
body{font-family:Arial;background:#eef2ff;padding:15px}
#search{width:100%;padding:10px;font-size:18px;margin-bottom:12px;border-radius:6px;border:2px solid #888}
table{width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden}
th,td{padding:10px;border-bottom:1px solid #ccc}
tr:hover{background:#d1fae5;cursor:pointer}
.activeRow{background:var(--selectedColor,#fef08a)!important}

/* Popup */
#overlay{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.5);display:none;
}
#card{
width:400px;background:white;padding:20px;border-radius:12px;
position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
box-shadow:0 8px 25px rgba(0,0,0,0.25);transition:.3s;
}
#card.show{transform:translate(-50%,-50%) scale(1)}

/* Buttons */
button{
padding:10px;margin:5px;border:none;border-radius:8px;font-size:15px;cursor:pointer}
.colorBtn{width:32px;height:32px;border-radius:50%;border:2px solid #222;cursor:pointer}
</style>
</head>
<body>

<h2>üìã Election Voter List</h2>

<input id="search" placeholder="üîç Search voter by name or EPIC...">

<table>
<thead>
<tr><th>Name</th><th>EPIC</th><th>Booth</th><th>Area</th></tr>
</thead>
<tbody id="voterTable"></tbody>
</table>

<!-- POPUP -->
<div id="overlay"></div>
<div id="card">
<h2 id="cName"></h2>
<hr>
<div id="info"></div>

<p><b>üé® Color Theme:</b></p>
<button class="colorBtn" style="background:#fca5a5" onclick="changeColor('#fca5a5')"></button>
<button class="colorBtn" style="background:#fffb91" onclick="changeColor('#fffb91')"></button>
<button class="colorBtn" style="background:#baffc9" onclick="changeColor('#baffc9')"></button>

<br><br>
<button onclick="printCard()">üñ® Print</button>
<button onclick="sendWhatsApp()">üì© WhatsApp</button>
<button onclick="closeCard()" style="background:#dc2626;color:white">‚ùå Close</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// üî• CHANGE THIS CONFIG WITH YOUR FIREBASE
const firebaseConfig = {
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let voters = {};
let activeKey = "";

const tbody = document.getElementById("voterTable");
const search = document.getElementById("search");

onValue(ref(db,"Voters"),snap=>{
voters = snap.val() || {};
renderTable(voters);
});

search.addEventListener("input",()=>{
let text = search.value.toLowerCase();
let filter = Object.fromEntries(
Object.entries(voters).filter(([k,v])=>
(v.Name+" "+v.Epic).toLowerCase().includes(text))
);
renderTable(filter);
});

function renderTable(data){
tbody.innerHTML="";
Object.entries(data).forEach(([key,v])=>{
let row=document.createElement("tr");
row.style.borderLeft=`6px solid ${v.Color||"#aaa"}`;
row.innerHTML=`
<td>${v.Name}</td>
<td>${v.Epic}</td>
<td>${v.Booth||"-"}</td>
<td>${v.Address||"-"}</td>`;
row.onclick=()=>openCard(key,row);
tbody.appendChild(row);
});
}

function openCard(key,row){
activeKey=key;

document.querySelectorAll("tr").forEach(r=>r.classList.remove("activeRow"));
row.classList.add("activeRow");

let v=voters[key];

document.documentElement.style.setProperty("--selectedColor",v.Color);

document.getElementById("cName").innerText=v.Name;

document.getElementById("info").innerHTML=`
<b>EPIC:</b> ${v.Epic}<br>
<b>Father/Relation:</b> ${v.ParentName || "-"} (${v.RelationType || "-"})<br>
<b>Relation:</b> ${v.Relation || "-"}<br>
<b>Booth:</b> ${v.Booth || "-"}<br>
<b>Voter Address:</b> ${v.VoterAddress || "-"}<br>
<b>Voting Address:</b> ${v.VotingAddress || "-"}<br>
<b>Description:</b> ${v.Description || "-"}
`;

document.getElementById("card").style.background=v.Color || "white";

document.getElementById("overlay").style.display="block";
document.getElementById("card").classList.add("show");
}

function closeCard(){
document.getElementById("overlay").style.display="none";
document.getElementById("card").classList.remove("show");
}

function changeColor(color){
update(ref(db,"Voters/"+activeKey),{Color:color});
document.getElementById("card").style.background=color;
document.documentElement.style.setProperty("--selectedColor",color);
renderTable(voters);
}

function printCard(){
let printContent=document.getElementById("card").innerHTML;
let win=window.open("");
win.document.write(`<html><body>${printContent}</body></html>`);
win.print();
}

function sendWhatsApp(){
let v=voters[activeKey];
let text=`üó≥ VOTER DETAILS:

üë§ Name: ${v.Name}
üÜî EPIC: ${v.Epic}
üë™ Parent: ${v.ParentName} (${v.RelationType})
üè† Address: ${v.VoterAddress}
üó≥ Voting Location: ${v.VotingAddress}
üìç Booth: ${v.Booth}
üìù Note: ${v.Description}

Sent via Voter App`;

window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
}

</script>
</body>
</html>
