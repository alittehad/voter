<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text to CSV Converter</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f9f9f9; }
  textarea { width: 100%; height: 200px; margin-bottom: 10px; }
  input, button { padding: 8px; margin-bottom: 10px; }
</style>
</head>
<body>

<h2>Text to CSV Converter</h2>

<label>Enter Headers (comma separated):</label><br>
<input type="text" id="headers" placeholder="Serial No,ID,Part No,Name,Father/Husband Name,House No,Age,Gender,Photo Available" style="width:100%;"><br>

<label>Paste Text Here:</label><br>
<textarea id="inputText" placeholder="Paste messy text here..."></textarea><br>

<button onclick="convertToCSV()">Convert to CSV</button>
<button onclick="downloadCSV()">Download CSV</button>

<h3>Preview:</h3>
<textarea id="outputCSV" readonly></textarea>

<script>
let csvContent = "";

function convertToCSV() {
    const headers = document.getElementById("headers").value.split(",");
    const text = document.getElementById("inputText").value.split(/\n+/);
    
    let csvArray = [];
    csvArray.push(headers); // Add headers first

    let serial = 1;
    for (let i = 0; i < text.length; i++) {
        const line = text[i].trim();
        if (line === "") continue;

        // Try to extract ID, Part No, Name, Father/Husband, House, Age, Gender, Photo
        const regex = /([A-Z0-9]+)\s+(\d+\/\d+\/\d+)\s*(.*)/;
        const match = line.match(regex);
        if (match) {
            const id = match[1];
            const partNo = match[2];
            const name = match[3].split("मतदाराचे पूर्ण|प्रोपर्टी रजिस्ट्रेशन:")[1] || match[3];
            
            // Minimal parsing, others left blank
            const row = [serial, id, partNo, name.trim(), "", "", "", "", ""];
            csvArray.push(row);
            serial++;
        }
    }

    // Convert array to CSV string
    csvContent = csvArray.map(r => r.map(f => `"${f}"`).join(",")).join("\n");
    document.getElementById("outputCSV").value = csvContent;
}

function downloadCSV() {
    if (!csvContent) {
        alert("Please convert first!");
        return;
    }
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "output.csv";
    link.click();
}
</script>

</body>
</html>
