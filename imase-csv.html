<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text to CSV</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f9f9f9; }
  textarea { width: 100%; height: 300px; margin-bottom: 10px; }
  input, button { padding: 8px; margin-bottom: 10px; width: 100%; }
</style>
</head>
<body>

<h2>Text to CSV Converter</h2>

<label>Enter Headers (comma separated):</label><br>
<input type="text" id="headers" placeholder="Serial No,ID,Part No,Name,Father/Husband Name,House No,Age,Gender,Photo Available"><br>

<label>Paste Text Here:</label><br>
<textarea id="inputText" placeholder="Paste messy text here..."></textarea><br>

<button onclick="convertToCSV()">Convert to CSV</button>
<button onclick="downloadCSV()">Download CSV</button>

<h3>Preview:</h3>
<textarea id="outputCSV" readonly></textarea>

<script>
let csvContent = "";

function convertToCSV() {
    const headers = document.getElementById("headers").value.split(",");
    const text = document.getElementById("inputText").value.split(/\n+/);

    let csvArray = [];
    csvArray.push(headers); // Add headers first

    let serial = 1;
    let row = [];
    for (let i = 0; i < text.length; i++) {
        const line = text[i].trim();
        if (line === "") continue;

        // Check for Voter/Property ID pattern (adjust regex if needed)
        const match = line.match(/([A-Z]{2,3}[0-9]+)\s+(\d+\/\d+\/\d+)/);
        if (match) {
            if (row.length > 0) csvArray.push(row); // Push previous row
            const id = match[1];
            const partNo = match[2];
            row = [serial, id, partNo]; // Start new row
            serial++;
        } else {
            row.push(line); // Add rest of the info in columns
        }
    }
    if (row.length > 0) csvArray.push(row);

    // Make sure each row has same columns as headers
    csvArray = csvArray.map(r => {
        const newRow = [];
        for (let j = 0; j < headers.length; j++) newRow.push(r[j] || "");
        return newRow;
    });

    // Convert array to CSV string
    csvContent = csvArray.map(r => r.map(f => `"${f}"`).join(",")).join("\n");
    document.getElementById("outputCSV").value = csvContent;
}

function downloadCSV() {
    if (!csvContent) {
        alert("Please convert first!");
        return;
    }
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "output.csv";
    link.click();
}
</script>

</body>
</html>
