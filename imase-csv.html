<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF to CSV Converter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<style>
body { font-family: Arial; padding: 20px; background: #f4f4f4; }
input, button { margin: 10px 0; padding: 10px; width: 100%; }
button { background: #007bff; color: white; border: none; cursor: pointer; }
button:hover { background: #0056b3; }
a { display: block; margin-top: 15px; }
</style>
</head>
<body>

<h2>PDF/Text to CSV Converter</h2>

<label>Upload PDF or Text File:</label>
<input type="file" id="fileInput" accept=".pdf,.txt">

<label>Enter CSV Headers (comma separated):</label>
<input type="text" id="csvHeader" placeholder="Serial No,ID,Part No,Name,Father/Husband Name,House No,Age,Gender,Photo Available">

<button onclick="convertPDFToCSV()">Convert & Download CSV</button>

<a id="downloadLink" style="display:none;">Download CSV</a>

<script>
async function convertPDFToCSV() {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) { alert('Please select a file!'); return; }
    
    const file = fileInput.files[0];
    let textContent = '';

    if(file.type === 'application/pdf') {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        for(let i=1; i<=pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const text = await page.getTextContent();
            textContent += text.items.map(item => item.str).join(' ') + '\n';
        }
    } else {
        textContent = await file.text();
    }

    // Get headers from user
    const headers = document.getElementById('csvHeader').value.split(',').map(h => h.trim());
    if(headers.length === 0) { alert('Enter CSV headers!'); return; }

    // Split text into lines
    const lines = textContent.split('\n').map(l => l.trim()).filter(l => l !== '');
    
    // Convert lines to CSV based on headers
    const rows = [];
    let serial = 1;

    lines.forEach(line => {
        if(!line) return;
        const row = [];
        headers.forEach(header => {
            let value = '';
            // Simple matching logic based on keywords
            if(header.toLowerCase().includes('serial')) value = serial++;
            else if(header.toLowerCase().includes('id')) {
                const match = line.match(/[A-Z]{2,3}\d{6,10}/);
                if(match) value = match[0];
            }
            else if(header.toLowerCase().includes('part')) {
                const match = line.match(/\d+\/\d+\/\d+/);
                if(match) value = match[0];
            }
            else if(header.toLowerCase().includes('name')) {
                const match = line.match(/मतदाराचे पूर्ण[:]*\s*([^\|]*)/);
                if(match) value = match[1].trim();
            }
            else if(header.toLowerCase().includes('father')) {
                const match = line.match(/वडिलांचे नाव\s*[:]*\s*([^\|]*)/);
                if(match) value = match[1].trim();
            }
            else if(header.toLowerCase().includes('house')) {
                const match = line.match(/घर क्रमांक\s*[:]*\s*([^\|]*)/);
                if(match) value = match ? match[1].trim() : '';
            }
            else if(header.toLowerCase().includes('age')) {
                const match = line.match(/वय\s*[:]*\s*([^\|]*)/);
                if(match) value = match[1].trim();
            }
            else if(header.toLowerCase().includes('gender')) {
                const match = line.match(/लिंग\s*[:]*\s*([^\|]*)/);
                if(match) value = match[1].trim();
            }
            else if(header.toLowerCase().includes('photo')) {
                value = line.includes('Photo') ? 'Available' : 'NA';
            }
            row.push(value);
        });
        rows.push(row);
    });

    // Generate CSV
    let csvContent = headers.join(',') + '\n';
    rows.forEach(r => {
        csvContent += r.map(v => `"${v}"`).join(',') + '\n';
    });

    const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const dl = document.getElementById('downloadLink');
    dl.href = url;
    dl.download = 'converted.csv';
    dl.style.display = 'block';
    dl.textContent = 'Download CSV';
}
</script>

</body>
</html>

