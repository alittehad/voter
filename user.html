<!DOCTYPE html>
<html>
<head>
<title>Voter List</title>
<style>
body { font-family: Arial; margin: 20px; background: #f4f4f4; }

table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ccc; padding: 10px; }
tr:hover { background: #d7ffd7; cursor: pointer; }

#popup {
  display: none; position: fixed; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: white; padding: 20px; width: 350px;
  border-radius: 10px; box-shadow: 0px 0px 20px black;
}

.color-btn { width: 25px; height: 25px; border-radius: 50%; border: none; cursor: pointer; margin: 5px; }

</style>
</head>
<body>

<h2>ğŸ—³ Election Voter Management</h2>

<textarea id="jsonInput" rows="6" style="width:100%" placeholder="Yaha JSON paste karo..."></textarea>
<br><br>
<button onclick="loadJSON()">Load JSON</button>

<br><br>

<input type="text" id="search" placeholder="Search voter..." onkeyup="filterTable()" style="width:100%; padding:8px;">

<br><br>

<table id="voterTable">
<thead>
<tr>
<th>Name</th>
<th>EPIC</th>
<th>AC</th>
<th>Part</th>
</tr>
</thead>
<tbody></tbody>
</table>


<div id="popup">
<h3 id="name"></h3>
<div id="details"></div>
<br>
<div>
<button class="color-btn" style="background:#ff9f9f" onclick="changeColor('#ff9f9f')"></button>
<button class="color-btn" style="background:#9fd3ff" onclick="changeColor('#9fd3ff')"></button>
<button class="color-btn" style="background:#caff9f" onclick="changeColor('#caff9f')"></button>
</div>
<br>
<button onclick="printCard()">ğŸ–¨ Print</button>
<button onclick="sendWhatsApp()">ğŸ“© WhatsApp</button>
<button onclick="closePopup()">âŒ Close</button>
</div>

<script>
let currentVoterKey = "";
let activeRow = null;
let data = {};

function loadJSON(){
    try {
        data = JSON.parse(document.getElementById("jsonInput").value);
        let tbody = document.querySelector("#voterTable tbody");
        tbody.innerHTML = "";

        Object.keys(data.Voters).forEach(key=>{
            let v = data.Voters[key];
            let row = document.createElement("tr");
            row.innerHTML = `
                <td>${v.Name}</td>
                <td>${v.Epic}</td>
                <td>${v.AcNo || '-'}</td>
                <td>${v.PartNo || '-'}</td>`;
            row.onclick = () => openCard(key, row);
            tbody.append(row);
        });

        alert("JSON Loaded Successfully!");
    } catch {
        alert("Invalid JSON!");
    }
}

function filterTable(){
    let s = document.getElementById("search").value.toLowerCase();
    document.querySelectorAll("#voterTable tbody tr").forEach(row=>{
        row.style.display = row.innerText.toLowerCase().includes(s) ? "" : "none";
    });
}

function openCard(key, row){
    currentVoterKey = key;
    activeRow = row;
    
    document.querySelectorAll("#voterTable tr").forEach(r=>r.style.background="white");

    let v = data.Voters[key];

    row.style.background = v.Color || "#ffd6a5";

    document.getElementById("name").innerHTML = v.Name;
    document.getElementById("details").innerHTML = `
        <b>EPIC:</b> ${v.Epic}<br>
        <b>AC No:</b> ${v.AcNo}<br>
        <b>Part No:</b> ${v.PartNo}<br>
        <b>Address:</b> ${v.Address || '-'}<br>
        <b>Voter Address:</b> ${v.VoterAddress || '-'}<br>
        <b>Voting Address:</b> ${v.VotingAddress || '-'}<br>
        <b>Relation:</b> ${v.Relation || '-'} (${v.RelationType || 'NA'})<br>
        <b>Description:</b> ${v.Description || '-'}<br><br>
        <b>Images:</b><br>
        ${(v.Images && v.Images.length) ? v.Images.map(img => `<img src="${img}" width="80" style="margin:5px;border-radius:6px;">`).join("") : "<i>No Images</i>"}
    `;

    document.getElementById("popup").style.display = "block";
    document.getElementById("popup").style.background = v.Color || "white";
}

function changeColor(c){
    document.getElementById("popup").style.background = c;
    if(activeRow) activeRow.style.background = c;
    data.Voters[currentVoterKey].Color = c;
}

function closePopup(){ document.getElementById("popup").style.display = "none"; }

function printCard(){ window.print(); }

function sendWhatsApp(){
    let v = data.Voters[currentVoterKey];
    let msg = `
ğŸ—³ *Voter Details*

ğŸ‘¤ Name: ${v.Name}
ğŸ†” EPIC: ${v.Epic}
ğŸ› AC: ${v.AcNo}
ğŸ“„ Part: ${v.PartNo}
ğŸ  Address: ${v.Address || '-'}
ğŸ“Œ Voting Address: ${v.VotingAddress || '-'}
ğŸ‘ª Relation: ${v.Relation || '-'} (${v.RelationType || 'NA'})
ğŸ“ Description: ${v.Description || '-'}
`;

    window.open("https://wa.me/?text=" + encodeURIComponent(msg));
}
</script>
</body>
</html>
