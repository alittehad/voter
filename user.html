<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Directory</title>
<style>
    body { font-family: Arial, sans-serif; background: #f3f4f6; padding: 20px;}

    h1 { text-align: center; }

    #searchBox {
        width: 100%; padding: 10px; margin-bottom: 10px;
        border: 2px solid #777; font-size: 16px; border-radius: 6px;
    }

    table {
        width: 100%; border-collapse: collapse; background: white;
        border-radius: 8px; overflow: hidden;
    }

    th, td {
        padding: 10px; border-bottom: 1px solid #ddd; cursor: pointer;
    }

    tr:hover { background: #d1fae5; }

    .activeRow { background: var(--selectedColor, #ffd166) !important; }

    /* Popup Card */
    #card {
        width: 350px; padding: 20px; background: white;
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
        border-radius: 15px; box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        transition: 0.3s; z-index: 1000;
    }

    #card.show { transform: translate(-50%, -50%) scale(1); }

    #overlay {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.55); display:none;
    }

    #overlay.active { display: block;}

    button {
        padding:10px; margin:5px; border:none; border-radius:10px;
        cursor:pointer; font-size:15px;
    }

    .colorBtn { width: 35px; height:35px; border-radius:50%; border:2px solid black; }
</style>
</head>
<body>

<h1>üìã Voter List</h1>

<input id="searchBox" placeholder="üîç Name search karein...">

<table id="voterTable">
    <thead>
        <tr><th>Name</th><th>EPIC</th><th>Booth</th></tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Popup -->
<div id="overlay"></div>
<div id="card">
    <h2 id="cName"></h2>
    <p><strong>EPIC:</strong> <span id="cEpic"></span></p>
    <p><strong>Parent:</strong> <span id="cParent"></span></p>
    <p><strong>Relation:</strong> <span id="cRelation"></span></p>
    <p><strong>Address:</strong> <span id="cAddress"></span></p>
    <p><strong>Voting Booth:</strong> <span id="cBooth"></span></p>
    <p><strong>Description:</strong> <span id="cDesc"></span></p>

    <br>
    üé® <b>Color Change:</b><br>
    <button class="colorBtn" style="background:#fca5a5" onclick="changeColor('#fca5a5')"></button>
    <button class="colorBtn" style="background:#fdff8f" onclick="changeColor('#fdff8f')"></button>
    <button class="colorBtn" style="background:#baffc9" onclick="changeColor('#baffc9')"></button>
    <br><br>

    <button onclick="printCard()">üñ® Print</button>
    <button onclick="shareWhatsApp()">üì© WhatsApp</button>
    <button onclick="closeCard()" style="background:red;color:white;">‚ùå Close</button>
</div>

<script type="module">

// Firebase import
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com/",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "0000000",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const tableBody = document.querySelector("#voterTable tbody");
const searchBox = document.getElementById("searchBox");

let voters = {};
let selectedKey = "";

onValue(ref(db, "Voters"), (snapshot) => {
    voters = snapshot.val();
    displayVoters(voters);
});

searchBox.addEventListener("input", () => {
    let value = searchBox.value.toLowerCase();
    let filtered = Object.fromEntries(
        Object.entries(voters).filter(([k, v]) => v.Name.toLowerCase().includes(value))
    );
    displayVoters(filtered);
});

function displayVoters(list){
    tableBody.innerHTML = "";
    Object.entries(list).forEach(([key, v]) => {
        let row = document.createElement("tr");
        row.style.borderLeft = `5px solid ${v.Color || "#ddd"}`;
        row.innerHTML = `<td>${v.Name}</td><td>${v.Epic}</td><td>${v.Booth || "-"}</td>`;
        row.onclick = () => openCard(key, row);
        tableBody.appendChild(row);
    });
}

function openCard(key, row){
    selectedKey = key;
    document.documentElement.style.setProperty("--selectedColor", voters[key].Color);

    document.querySelectorAll("tr").forEach(r=> r.classList.remove("activeRow"));
    row.classList.add("activeRow");

    document.getElementById("cName").innerText = voters[key].Name;
    document.getElementById("cEpic").innerText = voters[key].Epic;
    document.getElementById("cParent").innerText = voters[key].ParentName;
    document.getElementById("cRelation").innerText = voters[key].Relation;
    document.getElementById("cAddress").innerText = voters[key].Address;
    document.getElementById("cBooth").innerText = voters[key].Booth;
    document.getElementById("cDesc").innerText = voters[key].Description;

    document.getElementById("overlay").classList.add("active");
    document.getElementById("card").classList.add("show");
}

function closeCard(){
    document.getElementById("overlay").classList.remove("active");
    document.getElementById("card").classList.remove("show");
}

function changeColor(color){
    update(ref(db, "Voters/"+selectedKey), { Color: color });
}

function printCard(){
    let div = document.getElementById("card").innerHTML;
    let win = window.open("");
    win.document.write(`<html><body>${div}</body></html>`);
    win.print();
}

function shareWhatsApp(){
    let v = voters[selectedKey];
    let text = `üó≥ Voter Details:\n\nName: ${v.Name}\nEPIC: ${v.Epic}\nParent: ${v.ParentName}\nRelation: ${v.Relation}\nAddress: ${v.Address}\nBooth: ${v.Booth}\n\nSent via Election System`;
    window.open("https://wa.me/?text=" + encodeURIComponent(text));
}

</script>
</body>
</html>
