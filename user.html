<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter Management - Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { background:#eef2ff; }
.card { background:white; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:16px; margin-bottom:12px; }
.btn { cursor:pointer; padding:0.5rem 1rem; border-radius:0.5rem; font-weight:bold; transition:0.2s; }
.btn-blue { background:#2563eb;color:white; }
.btn-green { background:#16a34a;color:white; }
.btn-yellow { background:#facc15;color:black; }
.btn-red { background:#dc2626;color:white; }
.btn:hover { opacity:0.8; }
</style>
</head>
<body class="p-4">

<div class="text-center mb-4">
  <h1 class="text-2xl font-bold text-blue-700">Voter Management Panel</h1>
</div>

<!-- CSV Upload -->
<div class="bg-white p-4 rounded shadow mb-4">
  <h2 class="text-xl font-bold mb-2 text-blue-700">Upload Voter CSV</h2>
  <input type="text" id="csvLink" placeholder="CSV Link" class="border p-2 w-full mb-2">
  <button id="uploadCSV" class="btn btn-blue w-full">Upload CSV</button>
</div>

<!-- Manual Add Voter -->
<div class="bg-white p-4 rounded shadow mb-4">
  <h2 class="text-xl font-bold mb-2 text-blue-700">Add Voter Manually</h2>
  <input type="text" id="vName" placeholder="Name" class="border p-2 w-full mb-2">
  <input type="text" id="vEPIC" placeholder="EPIC" class="border p-2 w-full mb-2">
  <input type="text" id="vWard" placeholder="Ward" class="border p-2 w-full mb-2">
  <input type="text" id="vMobile" placeholder="Mobile" class="border p-2 w-full mb-2">
  <select id="vStatus" class="border p-2 w-full mb-2">
    <option value="anti">Anti</option>
    <option value="opponent">Opponent</option>
    <option value="approved">Approved</option>
  </select>
  <button id="addVoter" class="btn btn-green w-full">Add Voter</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref as dbRef, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import Papa from "https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.firebasestorage.app",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Manual Add Voter
document.getElementById("addVoter").onclick = ()=>{
  const n=document.getElementById("vName").value.trim();
  const e=document.getElementById("vEPIC").value.trim();
  const w=document.getElementById("vWard").value.trim() || "20";
  const m=document.getElementById("vMobile").value.trim();
  const s=document.getElementById("vStatus").value;
  if(!n||!e) return alert("Name और EPIC जरूरी हैं!");
  const key = e.replace(/\W/g,"_");
  set(dbRef(db,"voters/"+key), { name:n, voterID:e, ward:w, mobile:m, status:s })
    .then(()=>alert("Voter added!"))
    .catch(err=>{ console.error(err); alert("Add voter failed!"); });
};

// CSV Upload
document.getElementById("uploadCSV").onclick = ()=>{
  const link = document.getElementById("csvLink").value.trim();
  if(!link) return alert("CSV link डालें");
  fetch(link)
    .then(res => res.text())
    .then(csvText=>{
      Papa.parse(csvText,{header:true,skipEmptyLines:true,complete: results=>{
        results.data.forEach(row=>{
          if(!row.EPIC) return;
          const key = row.EPIC.replace(/\W/g,"_");
          set(dbRef(db,"voters/"+key), {
            name: row.Name || "",
            voterID: row.EPIC,
            ward: row.Ward || "20",
            mobile: row.Mobile || "",
            status: "anti"
          }).catch(err=>console.error("CSV upload failed for:", row.EPIC, err));
        });
        alert("CSV uploaded!");
      }});
    })
    .catch(err=>{ console.error(err); alert("CSV fetch failed!") });
};
</script>
</body>
</html>
