<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter Manager</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
</head>

<body class="bg-gray-100 p-6">

<div class="max-w-xl mx-auto bg-white shadow-md p-6 rounded-lg">
<h2 class="text-xl font-bold mb-4">ğŸ—³ Voter Information</h2>

<!-- Form -->
<label class="block mb-2 font-semibold">EPIC Number:</label>
<input id="epicSearch" class="w-full p-2 border rounded mb-2" placeholder="Enter EPIC">
<button id="loadBtn" class="bg-blue-600 text-white px-4 py-2 rounded mb-4 w-full">Load Details</button>

<div id="formArea" class="hidden">

<label>Name:</label>
<input id="name" class="w-full p-2 border rounded mb-2">

<label>AC No:</label>
<input id="acNo" class="w-full p-2 border rounded mb-2">

<label>Part No:</label>
<input id="partNo" class="w-full p-2 border rounded mb-2">

<label>Address:</label>
<input id="address" class="w-full p-2 border rounded mb-2">

<label>Booth:</label>
<input id="booth" class="w-full p-2 border rounded mb-2">

<label>Sender Note:</label>
<textarea id="note" class="w-full p-2 border rounded mb-2" placeholder="Write message..."></textarea>

<!-- Image Upload -->
<label>Voter Image</label>
<input type="file" id="uploadImage" class="w-full mb-2">

<img id="preview" class="hidden w-32 border rounded mb-2">

<button id="saveBtn" class="bg-green-600 text-white w-full py-2 rounded mb-2">ğŸ’¾ Save</button>
<button id="printBtn" class="bg-gray-600 text-white w-full py-2 rounded mb-2">ğŸ–¨ Print</button>
<button id="whatsappSend" class="bg-green-500 text-white w-full py-2 rounded">ğŸ“© WhatsApp</button>

</div>
</div>

<!-- PRINT AREA -->
<div id="printArea" class="hidden p-6">
    <h2 class="text-lg font-bold">Voter Detail</h2>
    <img id="printImg" class="w-32 my-2">
    <p id="printData" class="text-sm leading-6"></p>
</div>


<script>
/* -------- FIREBASE SETUP -------- */
const firebaseConfig = {
    apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
    authDomain: "voter-25c94.firebaseapp.com",
    databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
    projectId: "voter-25c94",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* -------- LOAD DETAILS -------- */
document.getElementById("loadBtn").addEventListener("click", async () => {
    const epic = document.getElementById("epicSearch").value;
    const snap = await db.ref("Voters/" + epic).get();

    if (!snap.exists()) return alert("No data found!");

    const data = snap.val();
    document.getElementById("formArea").classList.remove("hidden");

    document.getElementById("name").value = data.Name;
    document.getElementById("acNo").value = data.AcNo;
    document.getElementById("partNo").value = data.PartNo;
    document.getElementById("address").value = data.Address;
    document.getElementById("booth").value = data.VotingAddress;
});

/* -------- IMAGE UPLOAD (imgbb) -------- */
let uploadedImageURL = "";

document.getElementById("uploadImage").addEventListener("change", async function(){
    const file = this.files[0];
    const form = new FormData();
    form.append("image", file);

    let res = await fetch("https://api.imgbb.com/1/upload?key=7894e8cd9ee3a6cc520e2285d0b3f923", {method:"POST", body:form});
    let json = await res.json();

    uploadedImageURL = json.data.url;

    document.getElementById("preview").src = uploadedImageURL;
    document.getElementById("preview").classList.remove("hidden");
});

/* -------- SAVE -------- */
document.getElementById("saveBtn").addEventListener("click", () => {
    const epic = document.getElementById("epicSearch").value;
    db.ref("Voters/" + epic).update({
        Name: name.value,
        AcNo: acNo.value,
        PartNo: partNo.value,
        Address: address.value,
        VotingAddress: booth.value,
        Image: uploadedImageURL,
        Note: note.value
    });
    alert("Saved Successfully âœ…");
});

/* -------- PRINT FIX -------- */
document.getElementById("printBtn").addEventListener("click", () => {

    document.getElementById("printImg").src = uploadedImageURL;
    document.getElementById("printData").innerText =
`Name: ${name.value}
EPIC: ${epicSearch.value}
AC No: ${acNo.value}
Part No: ${partNo.value}
Address: ${address.value}
Booth: ${booth.value}
${note.value}`;

    document.getElementById("printArea").style.display = "block";

    setTimeout(() => {
        window.print();
    }, 300);
}); 

window.onafterprint = () =>{
    document.getElementById("printArea").style.display = "none";
};

/* -------- WHATSAPP SEND -------- */
document.getElementById("whatsappSend").addEventListener("click", () => {
    let phone = prompt("Enter 10 digit WhatsApp Number:");
    let message = 
`ğŸ‘¤ Name: ${name.value}
ğŸ†” EPIC: ${epicSearch.value}
ğŸ› AC No: ${acNo.value}
ğŸ“ Part No: ${partNo.value}
ğŸ  Address: ${address.value}
ğŸ—³ Booth: ${booth.value}

ğŸ“ Note:
${note.value}

ğŸ“¸ Image:
${uploadedImageURL}`;

    window.open(`https://wa.me/91${phone}?text=${encodeURIComponent(message)}`, "_blank");
});
</script>
</body>
</html>
