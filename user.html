<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Voter Search</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin:0;
  background:#f2f2f2;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
}

/* Search Input */
#search {
  width:90%;
  padding:12px;
  margin:10px 0;
  border-radius:10px;
  font-size:18px;
  border:2px solid #aaa;
  box-shadow:0 4px #ccc;
}

/* Voter List UI */
#list div {
  width:90%;
  background:white;
  margin:5px 0;
  padding:15px;
  border-radius:10px;
  font-size:18px;
  cursor:pointer;
  transition:0.2s;
  box-shadow:0 5px #ddd;
}

#list div:hover {
  transform:scale(1.03);
}

.selected {
  border:2px solid green;
}

/* Popup Box */
#popup {
  position:fixed;
  bottom:0;
  width:100%;
  left:0;
  background:white;
  padding:20px;
  border-radius:20px 20px 0 0;
  box-shadow:0 -5px 15px rgba(0,0,0,0.3);
  display:none;
}

#closeBtn {
  background:#ff4444;
  color:white;
  padding:10px;
  width:100px;
  border:none;
  border-radius:10px;
  font-size:18px;
  margin-top:10px;
  box-shadow:0 4px #b30000;
}

</style>
</head>
<body>

<h2>üìç Voter Search</h2>
<input type="text" id="search" placeholder="Search by Name, EPIC, Part, AC...">

<div id="list"></div>

<div id="popup">
  <div id="details"></div>
  <button id="closeBtn">Close</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

// üî• Your Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let voters = {};

const list = document.getElementById("list");
const search = document.getElementById("search");
const popup = document.getElementById("popup");
const details = document.getElementById("details");

// Load Data From Firebase
onValue(ref(db, "Voters"), snap => {
  voters = snap.val() || {};
  renderList("");
});

// Show List
function renderList(query){
  list.innerHTML="";
  Object.entries(voters).forEach(([id, v])=>{
    let match = `${id} ${v.Name} ${v.Epic} ${v.PartNo} ${v.AcNo}`.toLowerCase();

    if(match.includes(query.toLowerCase())){
      let row = document.createElement("div");
      row.innerHTML = `<b>${v.Name}</b><br>${v.Epic} | AC:${v.AcNo} | PART:${v.PartNo}`;
      row.onclick = ()=>openPopup(v, row);
      list.appendChild(row);
    }
  });
}

// Search Logic
search.oninput = ()=>renderList(search.value);

// Popup Show
function openPopup(v, element){
  document.querySelectorAll("#list div").forEach(x=>x.classList.remove("selected"));
  element.classList.add("selected");

  details.innerHTML = `
    <b>Name:</b> ${v.Name}<br>
    <b>EPIC:</b> ${v.Epic}<br>
    <b>AC No:</b> ${v.AcNo}<br>
    <b>Part No:</b> ${v.PartNo}<br>
    <b>Description:</b> ${v.Description || "No Notes"}<br>
  `;

  popup.style.display="block";
}

// Close Button
document.getElementById("closeBtn").onclick = ()=>{
  popup.style.display="none";
};
</script>
</body>
</html>
