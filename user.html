<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter System</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f1f5f9;
  margin: 0;
  padding: 15px;
}

button {
  width: 100%;
  padding: 15px;
  margin-top: 12px;
  font-size: 18px;
  font-weight: bold;
  background: linear-gradient(180deg,#4ade80,#22c55e);
  color: white;
  border: none;
  border-radius: 10px;
  box-shadow: 0 6px 0 #15803d;
  transition: all .15s;
}
button:active {
  transform: translateY(4px);
  box-shadow: 0 2px 0 #15803d;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 18px;
  margin-top: 10px;
  border-radius: 8px;
  border: 2px solid #94a3b8;
}

#list div {
  background: white;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  font-size: 18px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  cursor: pointer;
}

.popup{
 position: fixed;
 top: 50%; left: 50%;
 transform: translate(-50%, -50%);
 background: #ffffff;
 width: 90%;
 max-width: 400px;
 padding: 20px;
 border-radius: 12px;
 display:none;
 box-shadow: 0px 10px 30px rgba(0,0,0,0.3);
}

.color-btn{
 width: 33%;
 padding: 15px;
 border-radius: 10px;
 margin-top: 8px;
 cursor:pointer;
 border:2px solid #ccc;
}

.selected {
  border-left:8px solid red;
}
</style>
</head>
<body>

<h2>üó≥ Voter Search System</h2>

<input id="search" placeholder="Search Name / EPIC / AC / Part">
<div id="list"></div>

<div id="popup" class="popup">
<h3>ü™™ Voter Card</h3>
<div id="details"></div>

<br>
<b>üé® Select Card Color</b><br>
<div style="display:flex;gap:5px;">
 <div class="color-btn" style="background:#fde047" onclick="changeColor('#fde047')"></div>
 <div class="color-btn" style="background:#93c5fd" onclick="changeColor('#93c5fd')"></div>
 <div class="color-btn" style="background:#fecaca" onclick="changeColor('#fecaca')"></div>
</div>

<textarea id="desc" placeholder="Sender Message..." style="width:100%;height:80px;margin-top:10px;"></textarea>

<button onclick="sendWhatsApp()">üì© WhatsApp Send</button>
<button onclick="printCard()">üñ® Print Card</button>
<button onclick="closePopup()" style="background:#ef4444;box-shadow:0 6px 0 #b91c1c;">‚ùå Close</button>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let voters={}, selectedVoter=null;

onValue(ref(db, "Voters"), s => voters = s.val() || {});

// Search
document.getElementById("search").oninput = ()=>{
 list.innerHTML="";
 let q=search.value.toLowerCase();

 Object.values(voters).forEach(v=>{
  if(Object.values(v).join(" ").toLowerCase().includes(q)){
   let item=document.createElement("div");
   item.innerText=`${v.Name} (${v.Epic})  | AC:${v.AcNo}  Part:${v.PartNo}`;
   item.onclick=()=>openPopup(v,item);
   list.appendChild(item);
  }
 });
};

// Open Popup
function openPopup(v,e){
 selectedVoter=v;
 document.querySelectorAll("#list div").forEach(x=>x.classList.remove("selected"));
 e.classList.add("selected");

 let html="";
 Object.entries(v).forEach(([k,val])=>{
   html+=`<b>${k}</b>: ${val}<br>`;
 });

 details.innerHTML=html;
 popup.style.display="block";
}

window.changeColor=color=>{
 popup.style.background=color;
 document.querySelector(".selected").style.background=color;
};

window.printCard=()=>{
 let w=window.open("","","width=400,height=600");
 w.document.write(`<h2>Voter Card</h2>${details.innerHTML}<br><b>Message:</b>${desc.value}`);
 w.print();
 w.close();
};

window.sendWhatsApp=()=>{
 let msg = `${details.innerText}\n\nMessage:\n${desc.value}`;
 window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
};

window.closePopup=()=>popup.style.display="none";

</script>
</body>
</html>
