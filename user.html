<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter Panel Login Test</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">

<div id="loginDiv" class="text-center">
  <h1 class="text-2xl font-bold text-blue-700">Login to Access Voter Panel</h1>
  <button id="googleLoginBtn" class="btn btn-blue mt-4" style="padding:1rem 2rem; border-radius:0.5rem; background:#2563eb; color:white;">Login with Google</button>
</div>

<div id="panelDiv" class="hidden text-center">
  <h1 class="text-2xl font-bold text-green-700">Welcome to Voter Panel</h1>
  <p id="userEmail" class="mt-2"></p>
  <button id="logoutBtn" class="btn btn-red mt-4" style="padding:0.5rem 1rem; border-radius:0.5rem; background:#dc2626; color:white;">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  projectId: "voter-25c94",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// Hardcoded Admin/User
const admins = ["ngogrant454@gmail_com"];
const users  = ["zarafix3@gmail_com"];

const loginDiv = document.getElementById("loginDiv");
const panelDiv = document.getElementById("panelDiv");
const userEmailP = document.getElementById("userEmail");

document.getElementById("googleLoginBtn").onclick = ()=> {
  signInWithPopup(auth, provider)
    .then(res => {
      const emailKey = res.user.email.replace(/\./g,"_");
      if(admins.includes(emailKey) || users.includes(emailKey)){
        loginDiv.classList.add("hidden");
        panelDiv.classList.remove("hidden");
        userEmailP.innerText = `Logged in as: ${res.user.email}`;
      } else {
        alert("Access denied! Only admin/user allowed.");
        signOut(auth);
      }
    })
    .catch(err => { console.error(err); alert("Login failed: "+err.message); });
};

document.getElementById("logoutBtn").onclick = ()=>{
  signOut(auth).then(()=>{
    panelDiv.classList.add("hidden");
    loginDiv.classList.remove("hidden");
    alert("Logged out!");
  });
};
</script>
</body>
</html>
