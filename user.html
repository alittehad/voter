<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Voter Management Panel</title>
<script src="https://cdn.tailwindcss.com"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{--bg:#eef2ff;--card:#fff}
body{background:var(--bg);font-family:system-ui}
.card{background:var(--card)}
</style>
</head>

<body class="p-4">

<!-- Search -->
<div class="mb-4 flex gap-2">
<input id="search" type="text" placeholder="Search Name / EPIC"
class="w-full px-3 py-2 border rounded"/>
</div>

<!-- Table -->
<div>
<table class="w-full bg-white shadow rounded overflow-hidden">
<thead class="bg-blue-600 text-white">
<tr>
<th class="p-2 text-left">Name</th>
<th class="p-2 text-left">EPIC</th>
<th class="p-2 text-left">Booth</th>
<th class="p-2 text-left">Part</th>
<th class="p-2 text-left">Action</th>
</tr>
</thead>
<tbody id="voterTable"></tbody>
</table>
</div>

<!-- Detail Card -->
<div id="detailCard" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
<div class="card p-5 rounded shadow-lg w-96 relative">

<button onclick="closeCard()"
class="absolute top-2 right-2 text-red-500 text-xl">×</button>

<h2 class="text-xl font-bold mb-3">Voter Detail</h2>

<p><b>Name:</b> <span id="d_name"></span></p>
<p><b>EPIC:</b> <span id="d_epic"></span></p>
<p><b>Booth:</b> <span id="d_booth"></span></p>
<p><b>Part:</b> <span id="d_part"></span></p>
<p><b>Address:</b> <span id="d_address"></span></p>

<div class="flex gap-2 mt-4">
<button onclick="printCard()"
class="px-3 py-2 bg-black text-white rounded">Print</button>

<button onclick="sendWhatsApp()"
class="px-3 py-2 bg-green-600 text-white rounded">WhatsApp</button>
</div>

</div>
</div>

<script>
// ---------------------------
// Firebase Config
// ---------------------------
const firebaseConfig = {
apiKey: "YOUR_KEY",
authDomain: "YOUR_APP.firebaseapp.com",
databaseURL: "https://YOUR_APP.firebaseio.com",
projectId: "YOUR_APP",
storageBucket: "YOUR_APP.appspot.com",
messagingSenderId: "123",
appId: "123"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let voterData = [];
let selectedVoter = null;

// ---------------------------
// LOAD VOTERS
// ---------------------------
db.ref("voters").once("value", snap => {
    voterData = [];

    snap.forEach(c => {
        const d = c.val();

        // ⭐ JSON को उसके EXACT फॉर्मेट से map किया गया है ⭐
        voterData.push({
            id: c.key,
            name: d.name || "",
            epic: d.epic || "",
            voterID: d.epic || "",
            booth: d.booth || "",
            partNo: d.part || "",
            address: d.address || "",
            fatherName: d.fatherName || "",
            husbandName: d.husbandName || "",
            houseNo: d.houseNo || "",
            roomNo: d.roomNo || "",
            status: d.status || "anti"
        });
    });

    renderTable(voterData);
});

// ---------------------------
// RENDER TABLE
// ---------------------------
function renderTable(data){
    let html = "";

    data.forEach(v=>{
        html += `
        <tr class="border-b">
            <td class="p-2">${v.name}</td>
            <td class="p-2">${v.epic}</td>
            <td class="p-2">${v.booth}</td>
            <td class="p-2">${v.partNo}</td>
            <td class="p-2">
                <button onclick='openCard(${JSON.stringify(v)})'
                class="px-2 py-1 bg-blue-600 text-white rounded text-sm">Open</button>
            </td>
        </tr>`;
    });

    document.getElementById("voterTable").innerHTML = html;
}

// ---------------------------
// SEARCH
// ---------------------------
document.getElementById("search").addEventListener("input", e=>{
    let q = e.target.value.toLowerCase();

    let f = voterData.filter(v =>
        v.name.toLowerCase().includes(q) ||
        v.epic.toLowerCase().includes(q)
    );

    renderTable(f);
});

// ---------------------------
// OPEN DETAIL CARD
// ---------------------------
function openCard(v){
    selectedVoter = v;

    document.getElementById("d_name").innerText = v.name;
    document.getElementById("d_epic").innerText = v.epic;
    document.getElementById("d_booth").innerText = v.booth;
    document.getElementById("d_part").innerText = v.partNo;
    document.getElementById("d_address").innerText = v.address;

    document.getElementById("detailCard").classList.remove("hidden");
}

function closeCard(){
    document.getElementById("detailCard").classList.add("hidden");
}

// ---------------------------
// PRINT
// ---------------------------
function printCard(){
    let w = window.open("");
    w.document.write(`
        <h2>Voter Detail</h2>
        <p><b>Name:</b> ${selectedVoter.name}</p>
        <p><b>EPIC:</b> ${selectedVoter.epic}</p>
        <p><b>Booth:</b> ${selectedVoter.booth}</p>
        <p><b>Part:</b> ${selectedVoter.partNo}</p>
        <p><b>Address:</b> ${selectedVoter.address}</p>
    `);
    w.print();
}

// ---------------------------
// SEND WHATSAPP
// ---------------------------
function sendWhatsApp(){
    let msg =
`Name: ${selectedVoter.name}
EPIC: ${selectedVoter.epic}
Booth: ${selectedVoter.booth}
Part: ${selectedVoter.partNo}
Address: ${selectedVoter.address}`;

    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
}

</script>

</body>
</html>
