<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter List Software</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#eef2ff;margin:0;padding:0}
.login-box,.panel{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:10px;margin-top:40px;box-shadow:0 0 10px #ccc}
input,button{padding:10px;border-radius:6px;border:1px solid #999;width:100%;margin-top:10px}
button{background:#2563eb;color:#fff;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:20px}
table,th,td{border:1px solid #333}
th,td{padding:8px;text-align:left}
.hide{display:none}
.status-btn{padding:4px 8px;font-size:12px}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login-box" id="loginBox">
  <h2>Voter List Software Login</h2>

  <input id="loginUser" placeholder="Username">
  <input type="password" id="loginPass" placeholder="Password">

  <button onclick="login()">Login</button>

  <p>Admin IDs:<br>
  admin1 / 1234<br>
  admin2 / 1234<br>
  User ID:<br>
  user1 / 1111</p>
</div>

<!-- DASHBOARD -->
<div class="panel hide" id="panel">

  <h2>Voter Management Panel</h2>
  <p id="roleText"></p>

  <!-- CSV upload -->
  <input type="file" id="csvUpload" accept=".csv">
  <button onclick="uploadCSV()">Upload CSV</button>

  <table id="voterTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>EPIC</th>
        <th>Booth</th>
        <th>Address</th>
        <th>Status</th>
        <th>Photo</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<script>
// -------------------- LOGIN SYSTEM --------------------
const accounts = {
  admin1:{pass:"1234", role:"admin"},
  admin2:{pass:"1234", role:"admin"},
  user1:{pass:"1111", role:"user"}
};

function login(){
  let u = document.getElementById("loginUser").value;
  let p = document.getElementById("loginPass").value;

  if(accounts[u] && accounts[u].pass === p){
    localStorage.setItem("role", accounts[u].role);
    document.getElementById("loginBox").classList.add("hide");
    document.getElementById("panel").classList.remove("hide");
    document.getElementById("roleText").innerText = "Logged in as: " + accounts[u].role.toUpperCase();
    loadTable();
  } else {
    alert("Wrong username or password");
  }
}

// -------------------- CSV UPLOAD --------------------
let voters = JSON.parse(localStorage.getItem("voters") || "[]");

function uploadCSV(){
  let file = document.getElementById("csvUpload").files[0];
  if(!file){ alert("Select CSV first"); return }

  let reader = new FileReader();
  reader.onload = function(e){
    let text = e.target.result;
    let rows = text.split("\n");

    for(let i=1;i<rows.length;i++){
      let col = rows[i].split(",");
      if(col.length < 4) continue;

      voters.push({
        name: col[0],
        epic: col[1],
        booth: col[2],
        address: col[3],
        status: "pending",
        photo: ""
      });
    }

    localStorage.setItem("voters", JSON.stringify(voters));
    loadTable();
    alert("CSV Uploaded Successfully");
  };

  reader.readAsText(file);
}

// -------------------- TABLE RENDER --------------------
function loadTable(){
  let tbody = document.querySelector("#voterTable tbody");
  tbody.innerHTML = "";

  voters.forEach((v,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${v.name}</td>
        <td>${v.epic}</td>
        <td>${v.booth}</td>
        <td>${v.address}</td>
        <td>${v.status}</td>
        <td>${v.photo ? `<img src="${v.photo}" width="40">` : 'â€”'}</td>
        <td>
          <button class="status-btn" onclick="setStatus(${i},'approved')">Approved</button>
          <button class="status-btn" onclick="setStatus(${i},'opponent')">Opponent</button>
          <button class="status-btn" onclick="setStatus(${i},'anti')">Anti</button>
          <button onclick="uploadPhoto(${i})">Photo</button>
          <button onclick="sendWA(${i})">WhatsApp</button>
        </td>
      </tr>
    `;
  });
}

// -------------------- STATUS CHANGE --------------------
function setStatus(i, st){
  voters[i].status = st;
  localStorage.setItem("voters", JSON.stringify(voters));
  loadTable();
}

// -------------------- PHOTO UPLOAD --------------------
function uploadPhoto(i){
  let input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";

  input.onchange = function(e){
    let file = e.target.files[0];
    let reader = new FileReader();

    reader.onload = function(evt){
      voters[i].photo = evt.target.result;
      localStorage.setItem("voters", JSON.stringify(voters));
      loadTable();
    };
    reader.readAsDataURL(file);
  };

  input.click();
}

// -------------------- WHATSAPP SHARE --------------------
function sendWA(i){
  let v = voters[i];
  let msg = `Name: ${v.name}
EPIC: ${v.epic}
Booth: ${v.booth}
Address: ${v.address}
Status: ${v.status}`;

  window.open("https://wa.me/?text=" + encodeURIComponent(msg));
}
</script>

</body>
</html>
