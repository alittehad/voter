<!-- FULL WORKING VOTER SYSTEM WITH SENDER INFO (NO IMAGE) -->
<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voter List System</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .btn { @apply bg-blue-600 text-white px-4 py-2 rounded; }
  .btn-green { @apply bg-green-600 text-white px-4 py-2 rounded; }
  .btn-red { @apply bg-red-600 text-white px-4 py-2 rounded; }
  .btn-yellow { @apply bg-yellow-500 text-white px-4 py-2 rounded; }
</style>
</head>
<body class="bg-gray-100 p-4">
<h1 class="text-3xl font-bold text-center mb-4">Voter List System</h1>

<!-- Sender Info (Image removed) -->
<div class="bg-white p-4 rounded shadow mb-4">
  <h2 class="text-xl font-bold mb-2 text-blue-700">Sender Info</h2>
  <textarea id="senderDesc" placeholder="Sender Description" class="border p-2 w-full mb-2" disabled></textarea>
  <div class="flex gap-2">
    <button id="editSender" class="btn-yellow w-full">Edit</button>
    <button id="saveSender" class="btn-green w-full hidden">Save</button>
    <button id="deleteSender" class="btn-red w-full">Delete</button>
  </div>
</div>

<!-- Voter List Display -->
<div id="voterList" class="space-y-4"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref as dbRef, set, get, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "254695400035",
  appId: "1:254695400035:web:4ca75c3d363df238dab28c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ----------------- Sender Info Logic -----------------
const senderDesc = document.getElementById("senderDesc");
const editBtn = document.getElementById("editSender");
const saveBtn = document.getElementById("saveSender");
const deleteBtn = document.getElementById("deleteSender");

onValue(dbRef(db, "senderInfo"), snap => {
  if (snap.exists()) senderDesc.value = snap.val();
  else senderDesc.value = "";
});

editBtn.onclick = () => {
  senderDesc.disabled = false;
  saveBtn.classList.remove("hidden");
};

saveBtn.onclick = () => {
  set(dbRef(db, "senderInfo"), senderDesc.value.trim());
  senderDesc.disabled = true;
  saveBtn.classList.add("hidden");
  alert("Sender info saved!");
};

deleteBtn.onclick = () => {
  if (confirm("Delete sender info?")) {
    remove(dbRef(db, "senderInfo"));
    senderDesc.value = "";
    senderDesc.disabled = true;
    saveBtn.classList.add("hidden");
  }
};

// ---------------- Voter List Display ----------------
const voterList = document.getElementById("voterList");

onValue(dbRef(db, "voters"), snap => {
  voterList.innerHTML = "";
  if (!snap.exists()) return;

  const data = snap.val();
  Object.values(data).forEach(v => {
    const div = document.createElement("div");
    div.className = "bg-white p-4 rounded shadow";

    div.innerHTML = `
      <h3 class="font-bold text-lg text-blue-700">${v.name}</h3>
      <p><b>EPIC:</b> ${v.voterID}</p>
      <p><b>Address:</b> ${v.address}</p>
      <p><b>Part No:</b> ${v.partNo}</p>
      <p><b>Status:</b> ${v.status}</p>
      <div class="flex gap-2 mt-2">
        <button class="btn-green w-full sendBtn">Send</button>
        <button class="btn-yellow w-full printBtn">Print</button>
      </div>
    `;

    // WhatsApp (no image)
    div.querySelector(".sendBtn").onclick = () => {
      let msg = senderDesc.value + "\n\n";
      msg += `${v.name} | EPIC:${v.voterID} | Address:${v.address} | Part:${v.partNo} | Status:${v.status}`;
      const url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");
    };

    // Print (no image)
    div.querySelector(".printBtn").onclick = () => {
      let html = `<h2>Sender Info</h2><pre>${senderDesc.value}</pre><hr>`;
      html += `<p>${v.name} | EPIC:${v.voterID} | Address:${v.address} | Part:${v.partNo} | Status:${v.status}</p>`;
      const w = window.open();
      w.document.write(html);
      w.print();
      w.close();
    };

    voterList.appendChild(div);
  });
});

</script>
</body>
</html>
