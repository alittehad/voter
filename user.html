<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter List</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
    background: #f3f3f3;
}

h2 { text-align: center; margin-bottom: 15px; }

input {
    width: 100%; padding: 10px; margin-bottom: 12px;
    border-radius: 8px; border: 2px solid #777;
}

.list-item {
    padding: 12px; background: white; border: 2px solid #aaa;
    margin-bottom: 10px; border-radius: 10px;
    cursor: pointer; transition: .3s;
}
.list-item:hover { transform: scale(1.05); box-shadow:0 0 10px gray; }

#popup {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7);
    display:none; justify-content:center; align-items:center;
}

.card {
    width: 90%; max-width:410px;
    background:white; border:3px solid black;
    border-radius:15px; padding:20px;
    text-align:left;
}

/* Buttons */
.btn {
    padding:10px; width:100%; margin-top:10px;
    background:#008cff; color:white;
    border:none; cursor:pointer; font-size:16px;
    border-radius:10px; box-shadow:0 4px 0 #003f7f;
}
.btn:active { transform:translateY(4px); box-shadow:0 1px 0 #003f7f; }

.close-btn { background:red; box-shadow:0 4px 0 #7a0000; }

/* Color selector */
.color-box {
    width:40px; height:40px; border-radius:10px;
    margin:6px; cursor:pointer; border:2px solid black;
    display:inline-block;
}

/* PRINT MODE FIX */
@media print {
    .btn, .close-btn, textarea, .color-box, #themeTitle, #popup { display:none !important; }
    .card { width:100% !important; border:2px solid black; background:white !important; }
}
</style>
</head>

<body>

<h2>üó≥ Voter List</h2>
<input id="search" placeholder="Search Name, EPIC, AC No, Part No...">

<div id="list"></div>

<!-- POPUP -->
<div id="popup">
    <div class="card" id="cardBox">

        <h3 id="pName"></h3>
        <p><b>üÜî EPIC:</b> <span id="pEpic"></span></p>
        <p><b>üèõ AC No:</b> <span id="pAc"></span></p>
        <p><b>üìç Part No:</b> <span id="pPart"></span></p>
        <p><b>üè† Address:</b> <span id="pAddress"></span></p>
        <p><b>üó≥ Booth:</b> <span id="pVoteAddress"></span></p>

        <label><b>Sender Message:</b></label>
        <textarea id="senderNote" placeholder="Your note..." rows="4"
        style="width:100%;border-radius:8px;"></textarea>

        <h3 id="themeTitle">üé® Theme Color</h3>
        <div>
            <div class="color-box" onclick="setColor('#fca5a5')" style="background:#fca5a5"></div>
            <div class="color-box" onclick="setColor('#a5f7c5')" style="background:#a5f7c5"></div>
            <div class="color-box" onclick="setColor('#9fd1ff')" style="background:#9fd1ff"></div>
        </div>

        <button class="btn" onclick="printCard()">üñ® Print</button>
        <button class="btn" onclick="sendWA()">üì© WhatsApp Send</button>
        <button class="btn close-btn" onclick="closePopup()">‚ùå Close</button>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>

<script>
// Firebase Setup
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

firebase.initializeApp(firebaseConfig);

let voters = {};
let selected = null;

// Load Data
firebase.database().ref("Voters").on("value", snap => {
    voters = snap.val() || {};
    showList(voters);
});

// Show list
function showList(data){
    const box = document.getElementById("list");
    box.innerHTML = "";

    Object.values(data).forEach(v => {
        let div = document.createElement("div");
        div.className = "list-item";
        div.style.background = v.Color || "white";
        div.style.borderColor = v.Color || "#aaa";
        div.innerHTML = `${v.Name} <br> <small>${v.Epic}</small>`;
        div.onclick = () => openPopup(v);
        box.appendChild(div);
    });
}

// Open Popup
function openPopup(v){
    selected = v;
    document.getElementById("pName").innerText = v.Name;
    document.getElementById("pEpic").innerText = v.Epic;
    document.getElementById("pAc").innerText = v.AcNo;
    document.getElementById("pPart").innerText = v.PartNo;
    document.getElementById("pAddress").innerText = v.Address || "Not Available";
    document.getElementById("pVoteAddress").innerText = v.VotingAddress || "Not Available";

    document.getElementById("cardBox").style.background = v.Color || "white";
    document.getElementById("popup").style.display = "flex";
}

function closePopup(){
    document.getElementById("popup").style.display = "none";
}

// SAVE Color
function setColor(c){
    document.getElementById("cardBox").style.background = c;
    firebase.database().ref("Voters/" + selected.Epic).update({ Color: c });
    showList(voters);
}

// Print
function printCard(){ window.print(); }

// WhatsApp Sender
function sendWA(){
    let note = document.getElementById("senderNote").value || "‚Äî";

    let text = `*Voter Information*\n\nüë§ *${selected.Name}*\nüÜî EPIC: ${selected.Epic}\nüèõ AC No: ${selected.AcNo}\nüìç Part No: ${selected.PartNo}\nüè† Address: ${selected.Address}\nüó≥ Booth: ${selected.VotingAddress}\n\nüìù *Message:* ${note}`;

    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
}

// Search
document.getElementById("search").addEventListener("input", e=>{
    let t = e.target.value.toLowerCase();
    let f = Object.values(voters).filter(v =>
        v.Name.toLowerCase().includes(t) ||
        v.Epic.toLowerCase().includes(t) ||
        String(v.AcNo).includes(t) ||
        String(v.PartNo).includes(t)
    );
    showList(f);
});
</script>
</body>
</html>
