<!DOCTYPE html>
<html>
<head>
<title>Voter Search App</title>
<style>
body { font-family: Arial; margin: 20px; }
input, button { padding: 10px; width: 100%; margin-top: 10px; font-size: 18px; }
#list div { background: #e5e7eb; padding: 12px; margin-top: 10px; cursor: pointer; border-radius: 6px; transition: 0.3s; }
#list div:hover { transform: scale(1.02); }
.selected { border-left: 6px solid red; }

.popup{
 position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
 background:white; padding:20px; width:380px; border-radius:10px;
 box-shadow:0px 0px 10px #444; display:none;
}
.popup button{ width:100%; padding:10px; margin-top:10px; }

.color-btn { width: 30%; padding: 10px; border-radius: 5px; cursor: pointer; margin: 4px; }
.hidden { display:none; }
</style>
</head>
<body>

<h2>ğŸ” Google Login Required</h2>

<div id="loginSection">
<button id="googleLogin" style="background:#4285F4;color:white;">ğŸ”‘ Login with Google</button>
</div>

<div id="userPanel" class="hidden">
<p><b>Logged in as: </b><span id="userName"></span></p>
<button onclick="logout()" style="background:#ef4444;color:white;">ğŸšª Logout</button>
<hr>

<h2>ğŸ” Search Voter</h2>
<input id="search" placeholder="Search Name / EPIC / AC / Part">

<div id="list"></div>
</div>

<div id="popup" class="popup">
<h3>ğŸªª Voter Details</h3>
<div id="details"></div>

<p><b>Choose Card Color:</b></p>
<div style="display:flex;gap:5px;">
 <div class="color-btn" style="background:#fde68a" onclick="changeColor('#fde68a')"></div>
 <div class="color-btn" style="background:#a5f3fc" onclick="changeColor('#a5f3fc')"></div>
 <div class="color-btn" style="background:#fca5a5" onclick="changeColor('#fca5a5')"></div>
</div>

<textarea id="desc" placeholder="Sender Message..." style="width:100%;height:80px;margin-top:10px;"></textarea>

<button onclick="sendWhatsApp()">ğŸ“© Send WhatsApp</button>
<button onclick="printCard()">ğŸ–¨ Print</button>
<button onclick="closePopup()">âŒ Close</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let voters = {};
let users = {};
let loggedUser = null;
let selectedVoter = null;

db.ref("Users").on("value", s => users = s.val() || {});
db.ref("Voters").on("value", s => voters = s.val() || {});

// GOOGLE LOGIN
googleLogin.onclick = async ()=>{
  let provider = new firebase.auth.GoogleAuthProvider();
  let result = await auth.signInWithPopup(provider);
  let email = result.user.email;

  if(users[email]){
    loggedUser = users[email];
    document.getElementById("userName").innerText = loggedUser.Name;
    loginSection.classList.add("hidden");
    userPanel.classList.remove("hidden");
  } else {
    alert("âŒ Access Denied: Email Not Registered");
    auth.signOut();
  }
};

// LOGOUT
function logout(){
  auth.signOut();
  loggedUser = null;
  userPanel.classList.add("hidden");
  loginSection.classList.remove("hidden");
}

// SEARCH
search.oninput = ()=>{
 list.innerHTML="";
 if(!loggedUser) return;

 let q = search.value.toLowerCase();

 Object.values(voters).forEach(v=>{
   if(Object.values(v).join(" ").toLowerCase().includes(q)){
     let item=document.createElement("div");
     item.innerText=`${v.Name} (${v.Epic})`;
     item.onclick=()=>openPopup(v, item);
     list.appendChild(item);
   }
 });
};

// Popup Show
function openPopup(v, el){
 selectedVoter=v;
 document.querySelectorAll("#list div").forEach(x=>x.classList.remove("selected"));
 el.classList.add("selected");

 let html="";
 for(let k in v) html+= `<b>${k}</b>: ${v[k]}<br>`;
 details.innerHTML=html;
 popup.style.display="block";
}

// Color Change
function changeColor(color){
 popup.style.background=color;
 document.querySelector(".selected").style.background=color;
}

// Print
function printCard(){
 let w = window.open("", "", "width=400,height=600");
 w.document.write(`<h2>Voter Card</h2>${details.innerHTML}<br><b>Message:</b><br>${desc.value}`);
 w.print();
 w.close();
}

// WhatsApp Send
function sendWhatsApp(){
 let msg = `Voter Details:\n${details.innerText}\n\nMessage:\n${desc.value}`;
 window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
}

// Close Popup
function closePopup(){
 popup.style.display="none";
}
</script>

</body>
</html>
