<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Admin Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .btn-3d {
    background: linear-gradient(145deg, #4ade80, #16a34a);
    color: white;
    font-weight: bold;
    padding: 8px 16px;
    border-radius: 8px;
    box-shadow: 0 4px #15803d;
    transition: 0.2s;
  }
  .btn-3d:active {
    box-shadow: 0 2px #15803d;
    transform: translateY(2px);
  }
</style>
</head>
<body class="bg-gray-100 p-4">

<div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">
<h2 class="text-2xl font-bold mb-4 text-center">Super Admin Dashboard</h2>

<div id="dashboard" class="space-y-4"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const dashboard = document.getElementById("dashboard");

async function loadDashboard() {
  const userCredential = await signInWithPopup(auth, provider);
  const user = userCredential.user;

  if(user.email !== "ngogrant45@gmail.com") {
    alert("You are not Super Admin!");
    return;
  }

  const querySnapshot = await getDocs(collection(db, "registrations"));
  dashboard.innerHTML = "";

  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "flex justify-between items-center bg-gray-100 p-3 rounded-md shadow";

    let statusHtml = "";
    if(data.status === "pending"){
      statusHtml = `<button class="btn-3d text-sm" onclick="approve('${docSnap.id}')">Approve</button>`;
    } else {
      statusHtml = `<span class="font-medium text-green-600">Approved</span>`;
    }

    div.innerHTML = `
      <div>
        <p><strong>${data.name}</strong> (${data.role})</p>
        <p>${data.address} | ${data.mobile}</p>
      </div>
      <div>${statusHtml}</div>
    `;

    dashboard.appendChild(div);
  });
}

window.approve = async (id) => {
  await updateDoc(doc(db, "registrations", id), { status: "approved" });
  alert("User approved!");
  loadDashboard();
}

loadDashboard();
</script>
</body>
</html>
