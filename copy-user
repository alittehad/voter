<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Search System</title>
<style>

body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  padding:10px;
}

h2{
  text-align:center;
}

input{
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:8px;
  border:1px solid gray;
  margin-bottom:10px;
}

/* LIST */
#list{
  max-height:70vh;
  overflow-y:auto;
}

.voter-row{
  background:white;
  padding:14px;
  margin-bottom:8px;
  border-radius:10px;
  cursor:pointer;
  transition:0.2s;
  border-left:5px solid #ccc;
}
.voter-row:hover{
  background:#ddd;
}
.selected{
  border-left:6px solid #000 !important;
  font-weight:bold;
}

/* POPUP FULL SCREEN */
#popup{
  position:fixed;
  top:100%;
  left:0;
  width:100%;
  height:100%;
  background:white;
  padding:18px;
  border-radius:20px 20px 0 0;
  transition:0.4s;
  overflow-y:auto;
  z-index:999;
}
#popup.show{
  top:0;
}

/* color buttons */
.color-btns{
  display:flex;
  gap:12px;
  margin:10px 0;
}
.color-btn{
  width:40px;
  height:40px;
  border-radius:50%;
  border:2px solid white;
  cursor:pointer;
  box-shadow:0 0 6px rgba(0,0,0,0.3);
}

/* Buttons */
.popup-btn{
  width:100%;
  padding:14px;
  font-size:18px;
  font-weight:bold;
  border-radius:8px;
  border:none;
  margin-top:12px;
  cursor:pointer;
  box-shadow:0 4px rgba(0,0,0,0.2);
}
#printBtn{background:#007bff;color:white;}
#whatsappBtn{background:#25D366;color:white;}
#closeBtn{background:#ff4757;color:white;}

</style>
</head>
<body>

<h2>üó≥ Voter Search</h2>

<input type="text" id="search" placeholder="Search by Name, Epic, AC, Part...">

<div id="list"></div>

<!-- Popup -->
<div id="popup">
  <h2 id="cardTitle"></h2>
  <div id="details"></div>

  <h3>üé® Change Theme</h3>
  <div class="color-btns">
    <div class="color-btn" style="background:#ffe4e1" onclick="changeTheme('#ffe4e1')"></div>
    <div class="color-btn" style="background:#e3f2fd" onclick="changeTheme('#e3f2fd')"></div>
    <div class="color-btn" style="background:#fff9c4" onclick="changeTheme('#fff9c4')"></div>
  </div>

  <button id="printBtn" class="popup-btn">üñ® Print</button>
  <button id="whatsappBtn" class="popup-btn">üì© Send WhatsApp</button>
  <button id="closeBtn" class="popup-btn">‚ùå Close</button>
</div>


<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

// üî• Your Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCdjqVFKOQ1dtaXCGFUUtsJWbFdGNTo-xw",
  authDomain: "voter-25c94.firebaseapp.com",
  databaseURL: "https://voter-25c94-default-rtdb.firebaseio.com",
  projectId: "voter-25c94",
  storageBucket: "voter-25c94.appspot.com",
  messagingSenderId: "297773534400",
  appId: "1:297773534400:web:3722c487b8c83e9b787125"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let voters = {};
let currentVoter = null;
let selectedRow = null;

db.ref("Voters").on("value", snap=>{
  voters = snap.val();
  displayList(Object.values(voters));
});

function displayList(arr){
  list.innerHTML = "";
  arr.forEach(v=>{
    let div = document.createElement("div");
    div.className="voter-row";
    div.innerHTML = `<b>${v.Name}</b> <br> EPIC: ${v.Epic} | Part:${v.PartNo}`;
    div.onclick = ()=> openPopup(v,div);
    list.appendChild(div);
  });
}

search.oninput=()=>{
  let q = search.value.toLowerCase();
  let filtered = Object.values(voters).filter(v=> 
    (v.Name.toLowerCase().includes(q) ||
     v.Epic.toLowerCase().includes(q) ||
     String(v.PartNo).includes(q) ||
     String(v.AcNo).includes(q))
  );
  displayList(filtered);
};

function openPopup(voter, row){
  currentVoter = voter;
  selectedRow = row;

  document.querySelectorAll(".voter-row").forEach(r=>r.classList.remove("selected"));
  row.classList.add("selected");

  cardTitle.innerText = voter.Name;

  details.innerHTML = `
    <p><b>EPIC:</b> ${voter.Epic}</p>
    <p><b>AC Number:</b> ${voter.AcNo}</p>
    <p><b>Part Number:</b> ${voter.PartNo}</p>
    <p><b>Description:</b> ${voter.Description || "None"}</p>
  `;

  popup.style.background = voter.Color || "white";
  popup.classList.add("show");
}

function changeTheme(color){
  popup.style.background=color;
  selectedRow.style.background=color;
}

closeBtn.onclick=()=> popup.classList.remove("show");

printBtn.onclick=()=>{
  let p = open("","","width=600,height=600");
  p.document.write(`
    <h2>${currentVoter.Name}</h2>
    <p><b>EPIC:</b> ${currentVoter.Epic}</p>
    <p><b>AC:</b> ${currentVoter.AcNo}</p>
    <p><b>Part:</b> ${currentVoter.PartNo}</p>
  `);
  p.print();
};

whatsappBtn.onclick=()=>{
  let msg = `Voter Details:
Name: ${currentVoter.Name}
EPIC: ${currentVoter.Epic}
AC: ${currentVoter.AcNo}
Part: ${currentVoter.PartNo}`;
  open(`https://wa.me/?text=${encodeURIComponent(msg)}`,"_blank");
};

</script>
</body>
</html>
