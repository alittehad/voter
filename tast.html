<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voter List</title>

<style>
body { font-family: Arial; margin:0; padding:15px; background:#f1f1f1; }

.search-box {
    width:100%; padding:12px; font-size:18px;
    border:2px solid #444; border-radius:6px; margin-bottom:10px;
}

.voter-card {
    background:white; padding:15px; margin-top:10px;
    border-radius:8px; box-shadow:0 0 4px #aaa;
    cursor:pointer;
}

.popup {
    position:fixed; top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.6); display:none;
    align-items:center; justify-content:center;
}

.popup-box {
    background:white; padding:20px; width:90%;
    max-width:420px; border-radius:10px;
    box-shadow:0 0 10px black;
}

.close-btn {
    background:red; color:white; padding:8px 14px;
    border:0; border-radius:6px; float:right;
}
</style>

</head>
<body>

<h2>ðŸ“‹ Voter List</h2>

<input type="text" id="searchInput" class="search-box" placeholder="Search by Name / EPIC / Address / Age / Gender">

<div id="voterList"></div>

<!-- POPUP -->
<div id="popup" class="popup">
    <div class="popup-box">
        <button class="close-btn" onclick="closePopup()">Close</button>
        <div id="popupContent"></div>
    </div>
</div>

<script>
/* ------------ FIREBASE DATA LOAD ------------- */
const firebaseURL = "https://voter-25c94-default-rtdb.firebaseio.com/voters.json";

let voters = [];

fetch(firebaseURL)
    .then(res => res.json())
    .then(data => {
        if (!data) return;

        voters = Object.keys(data).map(key => ({
            key: key,
            epic_no: data[key].EPIC_NO || key,
            voter_full_name: data[key].VoterName || "",
            sl_no_in_part: data[key].PartNo || "",
            serial_no: data[key].SerialNo || "",
            address: (data[key].HouseNo === "NA" ? "" : data[key].HouseNo) || data[key].Address || "",
            relation_name: data[key].RelationName || "",
            relation_type: data[key].RelationType || "",
            age: data[key].Age || "",
            gender: data[key].Gender || ""
        }));

        displayList(voters);
    });


/* ------------ DISPLAY LIST ------------- */
function displayList(list) {
    const box = document.getElementById("voterList");
    box.innerHTML = "";

    list.forEach(v => {
        const div = document.createElement("div");
        div.className = "voter-card";
        div.innerHTML = `
            <b>${v.voter_full_name}</b><br>
            EPIC: ${v.epic_no}<br>
            Part/Serial: ${v.sl_no_in_part}<br>
            Gender: ${v.gender}
        `;
        div.onclick = () => openPopup(v);
        box.appendChild(div);
    });
}

/* ------------ SEARCH ------------- */
document.getElementById("searchInput").addEventListener("keyup", () => {
    const q = document.getElementById("searchInput").value.toLowerCase();

    const filtered = voters.filter(v =>
        (v.voter_full_name || "").toLowerCase().includes(q) ||
        (v.epic_no || "").toLowerCase().includes(q) ||
        (v.address || "").toLowerCase().includes(q) ||
        (v.age || "").toLowerCase().includes(q) ||
        (v.gender || "").toLowerCase().includes(q)
    );

    displayList(filtered);
});

/* ------------ POPUP ------------- */
function openPopup(v) {
    document.getElementById("popupContent").innerHTML = `
        <h3>${v.voter_full_name}</h3>

        <b>EPIC:</b> ${v.epic_no}<br>
        <b>Part/Serial:</b> ${v.sl_no_in_part}<br><br>

        <b>Address:</b><br>${v.address || "â€”"}<br><br>

        <b>Relation:</b> ${v.relation_type} : ${v.relation_name}<br><br>

        <b>Age/Gender:</b> ${v.age} / ${v.gender}<br>
    `;
    document.getElementById("popup").style.display = "flex";
}

function closePopup() {
    document.getElementById("popup").style.display = "none";
}
</script>

</body>
</html>
