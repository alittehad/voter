<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>Voter List</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  font-family: Arial;
  margin:0;
  background:#f2f2f2;
}
header{
  background:#1e88e5;
  color:#fff;
  padding:10px;
  text-align:center;
}
#search{
  width:95%;
  padding:10px;
  margin:10px;
  font-size:16px;
}
.list{
  max-height:60vh;
  overflow:auto;
}
.card{
  background:#fff;
  margin:8px;
  padding:10px;
  border-radius:6px;
  cursor:pointer;
}
.card:hover{background:#e3f2fd}

#detail{
  display:none;
  background:#fff;
  margin:10px;
  padding:12px;
  border-radius:8px;
}

.btn{
  padding:10px;
  margin:5px 0;
  width:100%;
  font-size:16px;
  border:none;
  border-radius:5px;
}
.print{background:#4caf50;color:#fff}
.wa{background:#25d366;color:#fff}

/* ================= PRINT FIX ================= */
@media print{
  body *{display:none}
  #printArea, #printArea *{
    display:block;
  }
}

/* ====== THERMAL 58mm ====== */
#printArea{
  width:58mm;
  font-size:12px;
}
.big{
  font-size:20px;
  font-weight:bold;
  text-align:center;
}
.center{text-align:center}
</style>
</head>

<body>

<header>
  <h2>‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§Ø‡§æ‡§¶‡•Ä</h2>
</header>

<input id="search" placeholder="‡§®‡§æ‡§µ / EPIC ‡§∂‡•ã‡§ß‡§æ">

<div class="list" id="list">Loading...</div>

<div id="detail">
  <div id="printArea">
    <div class="big">‚è∞</div>
    <div class="center"><b>‡§ò‡§°‡•Ä‡§≤‡§æ ‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§§‡§æ‡§Ç‡§®‡•Ä ‡§µ‡§ø‡§ú‡§Ø‡•Ä ‡§ï‡§∞‡§æ</b></div>
    <div class="center">‡§Ü‡§™‡§≤‡§æ ‡§¨‡§π‡•Å‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§Æ‡§§ ‡§®‡§ï‡•ç‡§ï‡•Ä ‡§¶‡•ç‡§Ø‡§æ</div>
    <hr>
    <div id="pName"></div>
    <div id="pEpic"></div>
    <div id="pHouse"></div>
    <div id="pBooth"></div>
  </div>

  <button class="btn print" onclick="printVoter()">üñ® Print</button>
  <button class="btn wa" onclick="sendWhatsApp()">üì≤ WhatsApp</button>
</div>

<script>
// üî• Firebase Config (‡§Ö‡§™‡§®‡§æ ‡§°‡§æ‡§≤‡•á‡§Ç)
firebase.initializeApp({
  apiKey:"YOUR_KEY",
  authDomain:"PROJECT.firebaseapp.com",
  projectId:"PROJECT"
});

const db = firebase.firestore();
let voters = [];
let active = null;

// LOAD DATA
db.collection("voters").limit(500).onSnapshot(s=>{
  voters=[];
  s.forEach(d=>voters.push(d.data()));
  render(voters);
});

// RENDER LIST
function render(data){
  let h="";
  data.forEach(v=>{
    h+=`<div class="card" onclick='openVoter(${JSON.stringify(v)})'>
      <b>${v.name}</b><br>
      EPIC: ${v.epic}
    </div>`;
  });
  document.getElementById("list").innerHTML=h || "No data";
}

// SEARCH FIX
search.oninput=()=>{
  let q=search.value.toLowerCase();
  render(voters.filter(v=>
    v.name.toLowerCase().includes(q) ||
    v.epic.toLowerCase().includes(q)
  ));
};

// OPEN SINGLE VOTER
function openVoter(v){
  active=v;
  detail.style.display="block";
  pName.innerHTML="‡§®‡§æ‡§µ: "+v.name;
  pEpic.innerHTML="EPIC: "+v.epic;
  pHouse.innerHTML="‡§ò‡§∞ ‡§®‡§Ç: "+v.house;
  pBooth.innerHTML="‡§¨‡•Ç‡§•: "+v.booth;
}

// PRINT FIX
function printVoter(){
  window.print();
}

// WHATSAPP
function sendWhatsApp(){
  let msg=
`‚è∞ ‡§ò‡§°‡•Ä‡§≤‡§æ ‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§§‡§æ‡§Ç‡§®‡•Ä ‡§µ‡§ø‡§ú‡§Ø‡•Ä ‡§ï‡§∞‡§æ
‡§Ü‡§™‡§≤‡§æ ‡§¨‡§π‡•Å‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§Æ‡§§ ‡§®‡§ï‡•ç‡§ï‡•Ä ‡§¶‡•ç‡§Ø‡§æ

‡§®‡§æ‡§µ: ${active.name}
EPIC: ${active.epic}
‡§ò‡§∞: ${active.house}
‡§¨‡•Ç‡§•: ${active.booth}`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
